## webpackç¬”è®°ï¼ˆä¸€ï¼‰â€” webpackåŸºæœ¬æ¦‚å¿µ

### ä¸€ã€å‰è¨€

==ç»„ä»¶æ¨¡å—åŒ–==æ˜¯ç›®å‰ä¸»æµçš„å¼€å‘æ–¹å¼ï¼Œé€šå¸¸æˆ‘ä»¬ä¼šå°†ä¸€ä¸ªåº”ç”¨æ¶‰åŠåˆ°çš„æ‰€æœ‰çš„åŠŸèƒ½æ‹†åˆ†ä¸ºä¸€ä¸ªä¸ª==ç»„ä»¶==ï¼Œå¦‚è·¯ç”±ç»„ä»¶ã€é¡µé¢ç»„ä»¶ã€è¡¨å•ç»„ä»¶ã€è¡¨æ ¼ç»„ä»¶ç­‰ï¼Œä¸€ä¸ªç»„ä»¶å¯¹åº”ä¸€ä¸ªæºæ–‡ä»¶ã€‚æºæ–‡ä»¶å¼€å‘å®Œæˆåˆ°åº”ç”¨éƒ¨ç½²ä¸Šçº¿ä¸­é—´ï¼Œæœ‰ä¸€æ­¥éª¤å¾ˆå…³é”®ï¼Œé‚£å°±æ˜¯==**æ„å»º**==ï¼ˆä¹Ÿå¯ç§°ä¹‹ä¸º**==æ‰“åŒ…==**ï¼‰ï¼Œ==æ„å»º==å°±æ˜¯æŠŠ==æºä»£ç ==è½¬æ¢æˆå‘å¸ƒåˆ°çº¿ä¸Šçš„å¯æ‰§è¡Œ **JavaScrip**ã€**CSS**ã€**HTML** ä»£ç 

> **==æ„å»º==**å…¶å®æ˜¯==å·¥ç¨‹åŒ–==ã€==è‡ªåŠ¨åŒ–==æ€æƒ³åœ¨å‰ç«¯å¼€å‘ä¸­çš„ä½“ç°ï¼ŒæŠŠä¸€ç³»åˆ—æµç¨‹ç”¨ä»£ç å»å®ç°ï¼Œè®©ä»£ç è‡ªåŠ¨åŒ–åœ°æ‰§è¡Œè¿™ä¸€ç³»åˆ—å¤æ‚çš„æµç¨‹ï¼Œæ„å»ºç»™å‰ç«¯å¼€å‘æ³¨å…¥äº†æ›´å¤§çš„æ´»åŠ›ï¼Œè§£æ”¾äº†æˆ‘ä»¬çš„ç”Ÿäº§åŠ›

è¢«ç”¨æ¥è¿›è¡Œ**æ„å»º**çš„å·¥å…·ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º==æ„å»ºå·¥å…·==ï¼Œè€Œ**webpack**æ­£æ˜¯ç›®å‰ä¸»æµçš„ä¸€æ¬¾æ„å»ºå·¥å…·

<!--å…³äºå‰ç«¯æ¨¡å—åŒ–å‘å±•åŠæ„å»ºå·¥å…·çš„å˜åŒ–ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹é¢ğŸ‘‡è¿™ç¯‡æ–‡ç«  -->

[å‰ç«¯æ„å»ºå·¥å…·çš„å‰ä¸–ä»Šç”Ÿ](https://juejin.cn/post/7121279495494959111)

### äºŒã€webpackç®€ä»‹

å…ˆçœ‹ä¸‹**webpack**å®˜ç½‘æ˜¯å¦‚ä½•å®šä¹‰è‡ªå·±çš„ğŸ‘‡ï¼š

> æœ¬è´¨ä¸Šï¼Œ**==webpack==** æ˜¯ä¸€ä¸ªç°ä»£ **JavaScript** åº”ç”¨ç¨‹åºçš„==é™æ€æ¨¡å—æ‰“åŒ…å™¨==(`module bundler`)ã€‚å½“ **webpack** å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šé€’å½’åœ°æ„å»ºä¸€ä¸ªä¾èµ–å…³ç³»å›¾`(dependency graph`)ï¼Œå…¶ä¸­åŒ…å«åº”ç”¨ç¨‹åºéœ€è¦çš„æ¯ä¸ªæ¨¡å—ï¼Œç„¶åå°†æ‰€æœ‰è¿™äº›æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ª `bundle`

**æ¨¡å—æ‰“åŒ…**ï¼Œé€šä¿—åœ°è¯´å°±æ˜¯ï¼š==æ‰¾å‡ºæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼ŒæŒ‰ç…§ä¸€å®šçš„è§„åˆ™æŠŠè¿™äº›æ¨¡å—**ç»„ç»‡åˆå¹¶**ä¸º**ä¸€ä¸ªJavaScriptæ–‡ä»¶**==

**Webpack**è®¤ä¸ºä¸€åˆ‡éƒ½æ˜¯**æ¨¡å—**ï¼ŒJSæ–‡ä»¶ã€CSSæ–‡ä»¶ã€jpg/pngå›¾ç‰‡ç­‰ç­‰éƒ½æ˜¯**==æ¨¡å—==**ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯èƒ½æ¸…æ™°åœ°æè¿°å‡ºå„ä¸ªæ¨¡å—ä¹‹é—´çš„**==ä¾èµ–å…³ç³»==**ï¼Œä»¥æ–¹ä¾¿ **Webpack** å¯¹æ¨¡å—è¿›è¡Œç»„åˆå’Œæ‰“åŒ…ã€‚

**Webpack**ä¼šæŠŠæ‰€æœ‰çš„è¿™äº›æ¨¡å—éƒ½åˆå¹¶ä¸ºä¸€ä¸ªJSæ–‡ä»¶ï¼Œè¿™æ˜¯å®ƒæœ€æœ¬è´¨çš„å·¥ä½œã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯èƒ½å¹¶ä¸æƒ³è¦å®ƒæŠŠè¿™äº›åˆå¹¶æˆä¸€ä¸ªJSæ–‡ä»¶ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€äº›è§„åˆ™æˆ–å·¥å…·æ¥æ”¹å˜å®ƒ

<img src="https://raw.githubusercontent.com/wanglufei561/picture_repo/master/assets/32af52ff9594b121517ecdd932644da4.png" alt="img" style="zoom: 30%;" />

<!--Webpackå®˜ç½‘ç¤ºæ„å›¾ï¼Œä»ä¸€ä¸ªjsæ–‡ä»¶å¼€å§‹æ„å»ºï¼Œæ‰“åŒ…æˆä¸€ä¸ªjsæ–‡ä»¶ï¼Œæœ€ååˆæ‹†åˆ†å‡ºéœ€è¦çš„4ç§æ–‡ä»¶-->

ä¸‹é¢æ˜¯**Webpack**çš„ä¸€äº›æ ¸å¿ƒæ¦‚å¿µå’ŒåŠŸèƒ½ï¼š

1. **entry**ï¼šå…¥å£æ–‡ä»¶ï¼Œ**Webpack**é€šè¿‡`entry`æ¥æ‰¾åˆ°==éœ€è¦æ‰“åŒ…çš„æ¨¡å—==<!--ä¸€ä¸ªåº”ç”¨å¯ä»¥æœ‰å¤šä¸ªå…¥å£æ–‡ä»¶ï¼Œæ¯ä¸ªå…¥å£æ–‡ä»¶å¯¹åº”ä¸€ä¸ªbundle-->

2. **output**ï¼šæ‰“åŒ…åçš„æ–‡ä»¶è¾“å‡ºçš„ä½ç½®å’Œæ–‡ä»¶å

3. **loader**ï¼š**==æ–‡ä»¶åŠ è½½å™¨==**ï¼Œèƒ½å¤ŸåŠ è½½èµ„æºæ–‡ä»¶ï¼Œå¹¶å¯¹è¿™äº›æ–‡ä»¶è¿›è¡Œä¸€äº›å¤„ç†ï¼Œè¯¸å¦‚ç¼–è¯‘ã€å‹ç¼©ç­‰ï¼Œæœ€ç»ˆä¸€èµ·æ‰“åŒ…åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­

   - **Loader**ä¸“æ³¨äº==æ–‡ä»¶çš„è½¬æ¢==ï¼Œä½¿å¾—**Webpack**èƒ½å¤Ÿå¤„ç†==é**JavaScript**æ¨¡å—==

   - ä¾‹å¦‚ï¼Œé€šè¿‡ä½¿ç”¨`css-loader`å’Œ`style-loader`ï¼Œ**Webpack**å¯ä»¥å¤„ç†**CSS**æ¨¡å—å¹¶å°†å…¶åµŒå…¥åˆ°**HTML**ä¸­

4. **plugin**ï¼šæ’ä»¶ï¼Œ**plugin**èµ‹äºˆäº†**Webpack**å„ç§çµæ´»çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ‰“åŒ…ä¼˜åŒ–ã€èµ„æºç®¡ç†ã€ç¯å¢ƒå˜é‡æ³¨å…¥ç­‰ï¼Œç›®çš„æ˜¯==è§£å†³**loader**æ— æ³•å®ç°çš„å…¶ä»–äº‹==

   - **plugin**æä¾›äº†æ›´ä¸°å¯Œçš„åŠŸèƒ½æ‰©å±•ï¼Œå¯ä»¥åœ¨==æ„å»ºè¿‡ç¨‹ä¸­==çš„ä¸åŒé˜¶æ®µæ’å…¥==è‡ªå®šä¹‰é€»è¾‘==
     - ä¾‹å¦‚å‹ç¼©ä»£ç ã€æ‹·è´æ–‡ä»¶ç­‰
   - **plugin**åœ¨æ•´ä¸ªç¼–è¯‘å‘¨æœŸéƒ½èµ·ä½œç”¨

5. **mode**ï¼šè®¾ç½®`mode`å¯ä»¥æŒ‡å®š**Webpack**çš„è¿è¡Œæ¨¡å¼ï¼Œå¯ä»¥æ˜¯`development`ã€`production`æˆ–`none`

   - ä¸åŒçš„æ¨¡å¼ä¼šå¯¹**Webpack**çš„è¡Œä¸ºè¿›è¡Œä¼˜åŒ–ï¼Œä¾‹å¦‚`development`æ¨¡å¼ä¼šå¯ç”¨`devtool`æ¥æ–¹ä¾¿è°ƒè¯•

6. **resolve** ï¼šç”¨äºè®¾ç½®æ¨¡å—å¦‚ä½•è§£æ

   å¸¸ç”¨é…ç½®å¦‚ä¸‹ï¼š

   - `alias`ï¼šé…ç½®åˆ«åï¼Œç®€åŒ–æ¨¡å—å¼•å…¥
   - `extensions`ï¼šåœ¨å¼•å…¥æ¨¡å—æ—¶å¯ä¸å¸¦åç¼€
   - `symlinks`ï¼šç”¨äºé…ç½® `npm link` æ˜¯å¦ç”Ÿæ•ˆï¼Œç¦ç”¨å¯æå‡ç¼–è¯‘é€Ÿåº¦

7. **optimization**ï¼š ç”¨äºè‡ªå®šä¹‰ **Webpack** çš„å†…ç½®ä¼˜åŒ–é…ç½®ï¼Œä¸€èˆ¬ç”¨äºç”Ÿäº§æ¨¡å¼æå‡æ€§èƒ½

   å¸¸ç”¨é…ç½®é¡¹å¦‚ä¸‹ï¼š

   - `minimize`ï¼šæ˜¯å¦éœ€è¦å‹ç¼© **bundle**
   - `minimizer`ï¼šé…ç½®å‹ç¼©å·¥å…·ï¼Œå¦‚ **TerserPlugin**ã€**OptimizeCSSAssetsPlugin**
   - `splitChunks`ï¼šæ‹†åˆ† **bundle**
   - `runtimeChunk`ï¼šæ˜¯å¦éœ€è¦å°†æ‰€æœ‰ç”Ÿæˆ **chunk** ä¹‹é—´å…±äº«çš„è¿è¡Œæ—¶æ–‡ä»¶æ‹†åˆ†å‡ºæ¥

8. **Code Splitting**ï¼šå°†æ‰“åŒ…åçš„ä»£ç æ‹†åˆ†æˆå¤šä¸ª`chunk`ï¼Œä»¥ä¼˜åŒ–æ€§èƒ½å’Œå‡å°‘åŠ è½½æ—¶é—´

9. **Dev Server**ï¼šå¯ä»¥ä½¿ç”¨`webpack-dev-server`æ¥å¯åŠ¨ä¸€ä¸ªæœ¬åœ°å¼€å‘æœåŠ¡å™¨ï¼Œæ–¹ä¾¿åœ¨å¼€å‘è¿‡ç¨‹ä¸­è°ƒè¯•å’Œçƒ­æ›´æ–°

### ä¸‰ã€webpackçš„åŸºæœ¬ä½¿ç”¨

**å®‰è£…**

```shell
npm install  webpack webpack-cli --save-dev
```

`webpack`æ˜¯æ‰“åŒ…çš„æ ¸å¿ƒåŒ…ï¼Œ`webpack-cli`æ˜¯å‘½ä»¤è¡Œå·¥å…·

**é…ç½®è„šæœ¬å‘½ä»¤**

```js
// package.json

"scripts": {
  "build": "webpack --mode=production",
  "dev": "webpack"
},
```

**åˆ›å»ºé…ç½®æ–‡ä»¶**

```js
// webpack.config.js
module.exports = {

};
```

æ¥ä¸‹æ¥æ˜¯å…·ä½“çš„é…ç½®é¡¹ğŸ‘‡

#### 3.1ã€ å…¥å£(entry)

- å…¥å£èµ·ç‚¹(`entry point`)æŒ‡ç¤º **webpack** åº”è¯¥ä½¿ç”¨å“ªä¸ªæ¨¡å—ï¼Œæ¥ä½œä¸ºæ„å»ºå…¶å†…éƒ¨ä¾èµ–å›¾(`dependency graph`) çš„**å¼€å§‹**ã€‚è¿›å…¥å…¥å£èµ·ç‚¹åï¼Œ**webpack**ä¼šæ‰¾å‡ºæœ‰==å“ªäº›æ¨¡å—å’Œåº“æ˜¯å…¥å£èµ·ç‚¹ï¼ˆç›´æ¥å’Œé—´æ¥ï¼‰ä¾èµ–çš„==
- é»˜è®¤å€¼æ˜¯ `./src/index.js`ï¼Œä½†ä½ å¯ä»¥é€šè¿‡åœ¨ `webpack configuration` ä¸­é…ç½® `entry` å±æ€§ï¼Œæ¥æŒ‡å®šä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰ä¸åŒçš„å…¥å£èµ·ç‚¹

 `src\index.js`

```js
const A = 111
console.log(A)
```

 `webpack.config.js`

```js
const path = require('path');
module.exports = {
  entry: './src/index.js',
};
```

#### 3.2ã€ è¾“å‡º(output)

- `output` å±æ€§å‘Šè¯‰**webpack**åœ¨å“ªé‡Œè¾“å‡ºå®ƒæ‰€åˆ›å»ºçš„ `bundle`ï¼Œä»¥åŠå¦‚ä½•å‘½åè¿™äº›æ–‡ä»¶
- ä¸»è¦è¾“å‡ºæ–‡ä»¶çš„é»˜è®¤å€¼æ˜¯ `./dist/main.js`ï¼Œå…¶ä»–ç”Ÿæˆæ–‡ä»¶é»˜è®¤æ”¾ç½®åœ¨ `./dist` æ–‡ä»¶å¤¹ä¸­ã€‚

`webpack.config.js`

```diff
const path = require('path');
module.exports = {
  entry: './src/index.js',
+  output: {
+    path: path.resolve(__dirname, 'dist'),
+    filename: 'main.js'
+  }
};
```

æ‰§è¡Œæ‰“åŒ…å‘½ä»¤

```shell
npm run dev
```

çœ‹ä¸‹è¾“å‡ºæ–‡ä»¶`./dist/main.js`

```js
console.log(111);
```

#### 3.3ã€ loader

- ==**webpack** åªèƒ½ç†è§£ `JavaScript` å’Œ `JSON` æ–‡ä»¶==
- **loader** è®© **webpack** èƒ½å¤Ÿå»å¤„ç†å…¶ä»–ç±»å‹çš„æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬è½¬æ¢ä¸ºæœ‰æ•ˆæ¨¡å—ï¼Œä»¥ä¾›åº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œä»¥åŠè¢«æ·»åŠ åˆ°ä¾èµ–å›¾ä¸­

`webpack.config.js`

```diff
const path = require('path');
module.exports = {
  mode: 'development',
  devtool:false,
  entry: './src/index.js',
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'main.js'
  },
+  module: {
+    rules: [
+      { test: /\.css$/, use: ['style-loader','css-loader']}
+    ]
+  }
};
```

<!--loaderæ˜¯ä»å³å¾€å·¦çš„é¡ºåºç”Ÿæ•ˆçš„ï¼Œæœ€å³ä¾§çš„loaderè¯»çš„æ˜¯æºæ–‡ä»¶å†…å®¹ æœ€å·¦ä¾§çš„loaderä¸€å®šä¼šè¿”å›ä¸€ä¸ªjsæ¨¡å—-->

#### 3.4ã€ æ’ä»¶(plugin)

- **loader** ç”¨äºè½¬æ¢æŸäº›ç±»å‹çš„æ¨¡å—
- **æ’ä»¶(plugin)**ç›®çš„åœ¨äºè§£å†³ **loader**æ— æ³•å®ç°çš„**å…¶ä»–äº‹**ï¼Œæ’ä»¶å¯ä»¥ç”¨äºæ‰§è¡ŒèŒƒå›´æ›´å¹¿çš„ä»»åŠ¡ï¼ŒåŒ…æ‹¬ï¼šæ‰“åŒ…ä¼˜åŒ–ï¼Œèµ„æºç®¡ç†ï¼Œæ³¨å…¥ç¯å¢ƒå˜é‡

`src\index.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>webpack5</title>
</head>
<body>
</body>
</html>
```

`webpack.config.js`

```diff
const path = require('path');
+const HtmlWebpackPlugin = require('html-webpack-plugin');
module.exports = {
  mode: 'development',
  devtool:false,
  entry: './src/index.js',
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'main.js'
  },
  module: {
    rules: [
      { test: /\.css$/, use: ['style-loader','css-loader']}
    ]
  },
+  plugins: [
+    new HtmlWebpackPlugin({template: './src/index.html'})
+  ]
};
```

`html-webpack-plugin` è¿™ä¸ªæ’ä»¶çš„ä½œç”¨æ˜¯ï¼šå½“ä½¿ç”¨ `webpack`æ‰“åŒ…æ—¶ï¼Œåˆ›å»ºä¸€ä¸ª `html` æ–‡ä»¶ï¼Œå¹¶æŠŠ `webpack` æ‰“åŒ…åçš„é™æ€æ–‡ä»¶è‡ªåŠ¨æ’å…¥åˆ°è¿™ä¸ª `html` æ–‡ä»¶å½“ä¸­

#### 3.5ã€æ¨¡å¼(mode)

**webpack 4.x** ç‰ˆæœ¬å¼•å…¥äº† [mode](https://webpack.docschina.org/configuration/mode/) çš„æ¦‚å¿µ

`mode` æ˜¯`development`, `production` æˆ– `none` ä¹‹ä¸­çš„ä¸€ä¸ªï¼Œé»˜è®¤å€¼ä¸º`production`

- **`development` å¼€å‘ç¯å¢ƒ**
  - éœ€è¦ç”Ÿæˆ `sourcemap` æ–‡ä»¶
  - éœ€è¦æ‰“å° `debug` ä¿¡æ¯
  - éœ€è¦ `live reload` æˆ–è€… `hot reload` çš„åŠŸèƒ½
- **`production`ç”Ÿäº§ç¯å¢ƒ**
  - å¯èƒ½éœ€è¦åˆ†ç¦» **CSS** æˆå•ç‹¬çš„æ–‡ä»¶ï¼Œä»¥ä¾¿å¤šä¸ªé¡µé¢å…±äº«åŒä¸€ä¸ª **CSS** æ–‡ä»¶
  - éœ€è¦å‹ç¼© **HTML**/**CSS**/**JS** ä»£ç 
  - éœ€è¦å‹ç¼©å›¾ç‰‡

**ç¯å¢ƒå˜é‡çš„è®¾ç½®æ–¹å¼**

1. å‘½ä»¤è¡Œä¸­ä½¿ç”¨`--mode`ç”¨æ¥è®¾ç½®==æ¨¡å—å†…çš„`process.env.NODE_ENV`==
2. é…ç½®æ–‡ä»¶ä¸­è®¾ç½®`mode`å±æ€§æ¥è®¾ç½®==æ¨¡å—å†…çš„`process.env.NODE_ENV`==
3. é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨**webpack**æ’ä»¶`DefinePlugin`ç”¨æ¥è®¾ç½®==æ¨¡å—å†…çš„å…¨å±€å˜é‡==
4. å‘½ä»¤è¡Œä¸­ä½¿ç”¨è·¨å¹³å°è®¾ç½®ç¯å¢ƒå˜é‡çš„å·¥å…·`cross-env`æ¥è®¾ç½®==`node`ç¯å¢ƒ==çš„`process.env.NODE_ENV`
5. é€šè¿‡`.env`æ–‡ä»¶é…ç½®ç¯å¢ƒå˜é‡

**1ã€å‘½ä»¤è¡Œé…ç½®**

- `webpack`å‘½ä»¤çš„`mode`é»˜è®¤ä¸º`production`

- `webpack serve`å‘½ä»¤çš„`mode`é»˜è®¤ä¸º`development`

å¯ä»¥åœ¨==æ¨¡å—å†…==é€šè¿‡`process.env.NODE_ENV`è·å–å½“å‰çš„ç¯å¢ƒå˜é‡ï¼Œæ— æ³•åœ¨**webpack**é…ç½®æ–‡ä»¶ä¸­è·å–æ­¤å˜é‡

```json
"scripts": {
  "build": "webpack",
  "dev": "webpack serve"
},
```

 `src\index.js`

```js
console.log(process.env.NODE_ENV);// development | production
```

`webpack.config.js`

```js
console.log('NODE_ENV',process.env.NODE_ENV);// undefined
```

æˆ–è€…ä½¿ç”¨`--mode`ç›´æ¥æŒ‡å®šæ¨¡å—å†…çš„ç¯å¢ƒå˜é‡

```json
  "scripts": {
    "build": "webpack --mode=production",
    "dev": "webpack --mode=development serve"
  },
```

------

**2ã€é…ç½®æ–‡ä»¶ä¸­è®¾ç½®`mode`**

```js
module.exports = {
  mode: 'development'
}
```

------

**3ã€ä½¿ç”¨DefinePluginè®¾ç½®==æ¨¡å—å†…çš„å…¨å±€å˜é‡==**

- å¯ä»¥åœ¨ä»»æ„æ¨¡å—å†…é€šè¿‡ `process.env.NODE_ENV_XXX` <!--åªæ˜¯ä¸ªkey--> è·å–å½“å‰çš„ç¯å¢ƒå˜é‡
- æ— æ³•åœ¨`nodeç¯å¢ƒ`(**webpack** é…ç½®æ–‡ä»¶ä¸­)ä¸‹è·å–è®¾ç½®çš„ç¯å¢ƒå˜é‡

```js
plugins:[
   new webpack.DefinePlugin({
      'process.env.NODE_ENV_XXX':JSON.stringify(value)
   })
]   
```

`index.js`

```js
console.log(NODE_ENV);//  production
```

`webpack.config.js`

```js
console.log('process.env.NODE_ENV_XXX',process.env.NODE_ENV_XXX);// undefined
console.log('NODE_ENV',NODE_ENV);// error ï¼ï¼ï¼
```

------

**4ã€cross-env**

åªèƒ½è®¾ç½®`nodeç¯å¢ƒ`ä¸‹çš„å˜é‡`NODE_ENV`

`package.json`

```json
"scripts": {
  "build": "cross-env NODE_ENV=development webpack"
}
```

`webpack.config.js`

```js
console.log('process.env.NODE_ENV',process.env.NODE_ENV);// development
```

**5ã€`.env`æ–‡ä»¶**

é€šè¿‡ç¬¬ä¸‰æ–¹å·¥å…·åŒ…dotenvè¯»å–.envé…ç½®æ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡

é…ç½®æ–‡ä»¶

`.env`

```
NAME="AAAAA"
```

`environment/.prod.env`

```
NAME="PROD"
```

`environment/.dev.env`

```
NAME="DEV"
```

ä½¿ç”¨æ–¹å¼

```js
require('dotenv').config()
console.log(process.env.NAME) // AAAAA

const PROD = require('dotenv').config({ path: 'environment/.prod.env' })
console.log(PROD.parsed.NAME) // PROD

const DEV = require('dotenv').config({ path: 'environment/.dev.env' })
console.log(DEV.parsed.NAME) // DEV
```

### å››ã€å¼€å‘æœåŠ¡å™¨

#### 4.1ã€å®‰è£…æœåŠ¡å™¨

```js
npm install webpack-dev-server --save-dev
```

#### 4.2ã€webpack.config.js

| ç±»åˆ«      | é…ç½®åç§°   | æè¿°                                                         |
| :-------- | :--------- | :----------------------------------------------------------- |
| output    | path       | æŒ‡å®šè¾“å‡ºåˆ°ç¡¬ç›˜ä¸Šçš„ç›®å½•                                       |
| output    | publicPath | è¡¨ç¤ºçš„æ˜¯æ‰“åŒ…ç”Ÿæˆçš„index.htmlæ–‡ä»¶é‡Œé¢å¼•ç”¨èµ„æºçš„å‰ç¼€           |
| devServer | publicPath | è¡¨ç¤ºçš„æ˜¯æ‰“åŒ…ç”Ÿæˆçš„é™æ€æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®(è‹¥æ˜¯devServeré‡Œé¢çš„publicPathæ²¡æœ‰è®¾ç½®ï¼Œåˆ™ä¼šè®¤ä¸ºæ˜¯outputé‡Œé¢è®¾ç½®çš„publicPathçš„å€¼) |
| devServer | static     | ç”¨äºé…ç½®æä¾›é¢å¤–é™æ€æ–‡ä»¶å†…å®¹çš„ç›®å½•                           |

```js
module.exports = {
  devServer: {
    static: path.resolve(__dirname, 'public'),
    port: 8080,
    open: true
  }
}
```

#### 4.3ã€package.json

```diff
  "scripts": {
    "build": "webpack",
+   "dev": "webpack serve"
  }
```

è¿è¡Œå‘½ä»¤`npm run dev`ä¼šèµ·ä¸€ä¸ª8080çš„æœ¬åœ°æœåŠ¡ï¼Œå¹¶é»˜è®¤æ‰“å¼€ç½‘é¡µ

#### 4.4ã€webpack-dev-server

å…³äºå¼€å‘æœåŠ¡å™¨**webpack-dev-server**éœ€è¦çŸ¥é“çš„æ˜¯ï¼š

1. ä½¿ç”¨`webpack`æ‰“åŒ…é¡¹ç›®ï¼Œå¾—åˆ°è¾“å‡ºçš„æ–‡ä»¶ï¼Œ==æ”¾åˆ°è¾“å‡ºç›®å½•é‡Œ==<!--outputé…ç½®çš„ç›®å½•-->
2. ==ä½¿ç”¨`webpack-dev-server`ï¼ˆ`webpack serve`ï¼‰æ‰“åŒ…çš„è¯ï¼Œ**ç»“æœæ–‡ä»¶å¹¶ä¸ä¼šå†™å…¥ç¡¬ç›˜ï¼Œåªä¼šå†™åˆ°å†…å­˜é‡Œ**== <!--æ‰€ä»¥ä½¿ç”¨å¼€å‘æœåŠ¡å™¨æ—¶ï¼Œåœ¨å·¥ç¨‹é‡Œçœ‹ä¸åˆ°æ‰“åŒ…åçš„æ–‡ä»¶-->

`webpack-dev-server`ä¼šå¯ä¸€ä¸ª**httpæœåŠ¡å™¨**ï¼Œç”¨æ¥è¿”å›æ‰“åŒ…åçš„æ–‡ä»¶

**httpæœåŠ¡å™¨**çš„é™æ€æ–‡ä»¶æ ¹ç›®å½•æœ‰ä¸¤ä¸ªï¼š

1.æ‰“åŒ…åçš„`dist`ç›®å½•

2.æˆ‘ä»¬æŒ‡å®šçš„é™æ€æ–‡ä»¶æ ¹ç›®å½•

### äº”ã€æ”¯æŒlesså’Œsass

**å®‰è£…**

```shell
npm i less less-loader -D
npm i node-sass sass-loader -D
npm rebuild node-sass
```

`webpack.config.js`

```diff
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');
module.exports = {
  mode: 'development',
  devtool: false,
  entry: './src/index.js',
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: '[name].js'
  },
  module: {
    rules: [
      { test: /\.css$/, use: ['style-loader', 'css-loader'] },
+     { test: /\.less$/, use: ['style-loader','css-loader', 'less-loader'] },
+     { test: /\.scss$/, use: ['style-loader','css-loader', 'sass-loader'] }
    ]
  },
  plugins: [
    new HtmlWebpackPlugin({ template: './src/index.html' })
  ]
};
```

`src\index.html`

```diff
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>webpack5</title>
</head>
<body>
+  <div id="less-container">less-container</div>
+  <div id="sass-container">sass-container</div>
</body>
</html>
```

`src\index.js`

```diff
import './index.css';
+import './less.less';
+import './sass.scss';
```

`src\less.less`

```less
@color:blue;
#less-container{
    color:@color;
}
```

`src\sass.scss`

```less
$color:orange;
#sass-container{
    color:$color;
}
```

### å…­ã€èµ„æºæ¨¡å—

**èµ„æºæ¨¡å—**æ˜¯ä¸€ç§æ¨¡å—ç±»å‹ï¼Œå®ƒå…è®¸ä½¿ç”¨èµ„æºæ–‡ä»¶ï¼ˆå­—ä½“ï¼Œå›¾æ ‡ç­‰ï¼‰è€Œ==æ— éœ€é…ç½®é¢å¤– loader==

é€šè¿‡é…ç½®`type`å±æ€§è®¾ç½®èµ„æºå¯¼å‡ºç±»å‹

- `asset/source` ï¼šå¯¼å‡ºèµ„æºçš„æºä»£ç 
- `asset/resource` ï¼šå‘é€ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶å¹¶å¯¼å‡º **URL**
- `asset/inline` ï¼šå¯¼å‡ºä¸€ä¸ªèµ„æºçš„ `data` **URI**
- `asset` ï¼šåœ¨å¯¼å‡ºä¸€ä¸ª `data` **URI** å’Œå‘é€ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¹‹é—´è‡ªåŠ¨é€‰æ‹©ã€‚ä¹‹å‰é€šè¿‡ä½¿ç”¨ `url-loader`ï¼Œå¹¶ä¸”é…ç½®èµ„æºä½“ç§¯é™åˆ¶å®ç°

#### 6.1ã€webpack.config.js

```diff
module.exports = {
  module: {
    rules: [
      { test: /\.css$/, use: ['style-loader', 'css-loader'] },
      {
        test: /\.less$/,
        use: ['style-loader', 'css-loader', 'less-loader']
      },
      {
        test: /\.scss$/,
        use: ['style-loader', 'css-loader', 'sass-loader']
      },
+      {
+        test: /\.png$/, // ä¼šæŠŠpngå›¾ç‰‡è‡ªåŠ¨æ‹·è´åˆ°è¾“å‡ºç›®å½•ä¸­ï¼Œå¹¶è¿”å›æ–°è·¯å¾„æˆ–è€…è¯´åç§°
+        type: 'asset/resource',
+        generator: {
+          filename: 'png/[hash][ext]'
+        }
+      },
+      {
+        test: /\.ico$/, // ä¼šæŠŠicoæ–‡ä»¶å˜æˆbase64å­—ç¬¦ä¸²å¹¶è¿”å›ç»™è°ƒç”¨è€…
+        type: 'asset/inline'
+      },
+      {
+        test: /\.txt$/, // ä¼šæŠŠtxtå†…å®¹ç›´æ¥è¿”å›
+        type: 'asset/source'
+      },
+      {
+        test: /\.svg$/,
+        type: 'asset/resource'
+      },
+      {
+        test: /\.jpg$/,
+        type: 'asset', // è¡¨ç¤ºå¯ä»¥æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè‡ªé€‰æ‹©æ˜¯resourceè¿˜inline
+        parser: {
+          dataUrlCondition: {
+            maxSize: 4 * 1024 // å¦‚æœæ–‡ä»¶å¤§å°å°äº4Kå°±èµ°inline,å¦‚æœå¤§äº4Kå°±
+          }
+        },
+        generator: {
+          filename: 'jpg/[hash][ext]'
+        }
+      }
   ]
  },
};
```

`src\index.js`

```js
import png from './assets/logo.png';
import ico from './assets/logo.ico';
import jpg from './assets/logo.jpg';
import txt from './assets/logo.txt';
console.log(png,ico,jpg,txt);
```

### ä¸ƒã€JSå…¼å®¹æ€§å¤„ç†

JSå…¼å®¹æ€§é€šè¿‡Babelè¿›è¡Œå¤„ç†ï¼ŒBabelå…¶å®æ˜¯ä¸€ä¸ªç¼–è¯‘JavaScriptçš„å¹³å°,å¯ä»¥æŠŠES6/ES7,Reactçš„JSXè½¬ä¹‰ä¸ºES5

#### 7.1ã€å®‰è£…ä¾èµ–

- [babel-loader](https://www.npmjs.com/package/babel-loader)ä½¿ç”¨**Babel**å’Œ**webpack**è½¬è¯‘**JavaScript**æ–‡ä»¶
- [@babel/@babel/core](https://www.npmjs.com/package/@babel/core)**Babel**ç¼–è¯‘çš„æ ¸å¿ƒåŒ…
- [babel-preset-env](https://www.babeljs.cn/docs/babel-preset-env)
- [@babel/@babel/preset-react](https://www.npmjs.com/package/@babel/preset-react)**React**æ’ä»¶çš„**Babel**é¢„è®¾
- [@babel/plugin-proposal-decorators](https://babeljs.io/docs/en/babel-plugin-proposal-decorators)æŠŠç±»å’Œå¯¹è±¡è£…é¥°å™¨ç¼–è¯‘æˆ**ES5**
- [@babel/plugin-proposal-class-properties](https://babeljs.io/docs/en/babel-plugin-proposal-class-properties)è½¬æ¢é™æ€ç±»å±æ€§ä»¥åŠä½¿ç”¨å±æ€§åˆå§‹å€¼åŒ–è¯­æ³•å£°æ˜çš„å±æ€§

```js
npm i babel-loader @babel/core @babel/preset-env @babel/preset-react  -D
npm i @babel/plugin-proposal-decorators @babel/plugin-proposal-class-properties @babel/plugin-proposal-private-property-in-object  @babel/plugin-proposal-private-methods -D
```

#### 7.2ã€webpack.config.js

```diff
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');
const MiniCssExtractPlugin = require('mini-css-extract-plugin');
module.exports = {
  mode: 'development',
  devtool: false,
  entry: './src/index.js',
  output: {
    path: path.resolve(__dirname, 'dist'),
    filename: 'main.js',
  },
  module: {
    rules: [
+      {
+        test: /\.jsx?$/,
+        use: {
+          loader: 'babel-loader',
+          options: {
+            presets: ["@babel/preset-env", '@babel/preset-react'],
+            plugins: [
+              ["@babel/plugin-proposal-decorators", { legacy: true }],
+              ["@babel/plugin-proposal-private-property-in-object", { "loose": true }],
+              ["@babel/plugin-proposal-private-methods", { "loose": true }],
+              ["@babel/plugin-proposal-class-properties", { loose: true }],
+            ],
+          },
+        },
+      },
      { test: /\.css$/, use: ['style-loader', 'css-loader', 'postcss-loader'] },
      { test: /\.less$/, use: ['style-loader', 'css-loader','postcss-loader', 'less-loader'] },
      { test: /\.scss$/, use: ['style-loader', 'css-loader', 'postcss-loader','sass-loader'] },
      {
        test: /\.(jpg|png|gif|bmp|svg)$/,
        type:'asset/resource',
        generator:{
          filename:'images/[hash][ext]'
        }
      }
    ]
  },
  plugins: [
    new HtmlWebpackPlugin({ template: './src/index.html' })
  ]
};
```

`src\index.js`

```diff
+function readonly(target,key,descriptor) {
+    descriptor.writable=false;
+}
+
+class Person{
+    @readonly PI=3.14;
+}
+let p1=new Person();
+p1.PI=3.15;
+console.log(p1)
```

`jsconfig.json`

```json
{
  "compilerOptions": {
      "experimentalDecorators": true
  }
}
```

### å…«ã€æœåŠ¡å™¨ä»£ç†

å¦‚æœæœ‰å•ç‹¬çš„åç«¯å¼€å‘æœåŠ¡å™¨ APIï¼Œå¹¶ä¸”å¸Œæœ›åœ¨åŒåŸŸåä¸‹å‘é€ API è¯·æ±‚ ï¼Œé‚£ä¹ˆä»£ç†æŸäº› URL ä¼šå¾ˆæœ‰ç”¨ã€‚

#### 8.1ã€ä¸ä¿®æ”¹è·¯å¾„

è¯·æ±‚åˆ° `/api/users` ç°åœ¨ä¼šè¢«ä»£ç†åˆ°è¯·æ±‚ http://localhost:3000/api/usersã€‚

```js
devServer: {
  proxy: {
    "/api": 'http://localhost:3000'
  }
}
```

#### 8.2ã€ä¿®æ”¹è·¯å¾„

```js
devServer: {
  proxy: {
    '/api1': {
      target: 'http://localhost:3000',
      pathRewrite: {
        '^/api': '',
        '^/home/name/api': '/home/name',
      },
    },
    '/api2': {
      target: 'http://localhost:4000',
      pathRewrite: {
        '^/api': '',
        '^/home/name/api': '/home/name',
      },
    },
  },
}
```

#### 8.3ã€onBeforeSetupMiddleware

`onBeforeSetupMiddleware` åœ¨ `webpack-dev-server` é™æ€èµ„æºä¸­é—´ä»¶å¤„ç†ä¹‹å‰ï¼Œå¯ä»¥ç”¨äºæ‹¦æˆªéƒ¨åˆ†è¯·æ±‚è¿”å›ç‰¹å®šå†…å®¹ï¼Œæˆ–è€…å®ç°ç®€å•çš„æ•°æ® `mock`

```js
devServer: {
  onBeforeSetupMiddleware(devServer){// express()
      devServer.app.get('/api/users', (req, res) => {
        res.json([{ id: 1 }, { id: 2 }]);
      });
  }
}
```

