## CSS 中的样式优先级

### 一、前言

在 **CSS** 样式中，一个元素可能会同时被多个规则匹配，并且这些规则可能针对同一属性声明了不同的值

例如：

```css
div { color: black; }
.main { color: blue; }
#header { color: red; }
```

如果一个元素同时满足上述三个选择器的条件，浏览器必须有一套规则来决定**最终生效的样式**

**CSS 优先级（Specificity）**就是为了解决这个冲突而定义的**「权重机制」**

### 二、优先级计算

#### 2.1、 优先级的五个维度

可以先将 **CSS 优先级**分为五个维度，由高到低如下：

1. **`!important` 标记**

   - 在声明后加 `!important`，会使该属性的优先级最高（仅次于浏览器用户样式表中的 `!important`）
   - 它不会直接参与优先级计算，而是在比较之前先被分组，带 `!important` 的规则优先于不带的

2. **行内样式（Inline style）**

   - 写在 **HTML** 标签 `style` 属性中的样式，例如：

     ```html
     <div style="color: red;"></div>
     ```

   - 优先级高于任何选择器规则，但低于带 `!important` 的规则

3. **ID 选择器**

   - 如 `#app`

     <!--每出现一个 ID，权重加 1，在三段式中记作 A -->

4. **类 / 属性选择器 / 伪类**

   - 类选择器：`.main`

   - 属性选择器：`[type="text"]`

   - 伪类：`:hover`、`:nth-child()` 等

      <!--每出现一个，权重加 1，在三段式中记作 B -->

5. **元素 / 伪元素选择器**

   - 元素选择器：`div`、`p`
   
   - 伪元素：`::before`、`::after` 等
   
     <!--每出现一个，权重加 1，在三段式中记作 C -->

### 2.2、优先级三段式表示法

**W3C** 规范采用三段式 `(A, B, C)` 来表示选择器的优先级：

- **A**：匹配到的 ID 选择器个数
- **B**：匹配到的类、属性选择器、伪类个数
- **C**：匹配到的元素选择器、伪元素个数

在实际计算时：

- 先判断是否有 `!important`，再判断是否为行内样式
- 普通选择器之间通过 `(A, B, C)` 比较
  - A 大者优先
  - A 相等时比较 B
  - 若仍相等则比较 C
  - 三者相等时，后定义的规则覆盖先定义的规则


**注意特殊伪类的优先级规则：**

- `:not()`：本身不增加优先级，括号内选择器参与计算
- `:is()`：取括号内优先级最高的选择器参与计算
- `:where()`：括号内选择器匹配元素，但优先级恒为 `(0,0,0)`

### 三、示例

#### 3.1、基础比较

```css
div { color: black; }         /* (0,0,1) */
.main { color: blue; }        /* (0,1,0) */
#header { color: red; }       /* (1,0,0) */
```

匹配 `<div id="header" class="main">`： ID 选择器权重最高，最终颜色为 **红色**

#### 3.2、组合选择器

```css
.nav a { color: blue; }            /* (0,1,1) */
#header .nav a { color: green; }   /* (1,1,1) */
```

当 `<a>` 位于 `#header .nav` 内部时，绿色 `(1,1,1)` 优先于蓝色 `(0,1,1)`。

#### 3.3、伪类与伪元素

```css
p::first-line { color: red; }     /* (0,0,2) */
p.highlight { color: blue; }      /* (0,1,1) */
```

`.highlight` 中的类选择器增加了 B 值，优先级 `(0,1,1)` 高于 `(0,0,2)`，结果为 **蓝色**

#### 3.4、特殊伪类

```css
:where(.btn).primary { color: red; }   /* 优先级 (0,0,1) */
:is(#main, .nav) { color: blue; }      /* 优先级 (1,0,0) 来自 #main */
div:not(.disabled) { color: green; }   /* 优先级 (0,1,1) */
```

- `:where()`：不增加优先级
- `:is()`：取内部最高优先级
- `:not()`：括号内容参与优先级计算

#### 3.5、行内样式与 `!important`

```html
<div id="app" style="color: blue;">文本</div>
#app { color: red; }
```

结果为 **蓝色**（行内样式优先）

```css
#app { color: red !important; }
```

结果为 **红色**（`!important` 覆盖行内样式）

### 四、**总结**

 **CSS 优先级**解决了多规则冲突问题，核心是：

1. 先分组（`!important` > 行内样式 > 普通选择器）
2. 普通选择器之间用三段式 `(A, B, C)` 比较
3. 避免滥用高优先级选择器，保持样式可维护性
