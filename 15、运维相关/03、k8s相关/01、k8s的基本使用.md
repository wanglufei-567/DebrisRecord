## k8s笔记（一）k8s的基本使用

### 一、前言

#### 1.1、什么是 Kubernetes？

> **Kubernetes** 是一个开源平台，用于管理「**容器化**」的应用程序和服务，它可以自动化部署、扩展和管理这些应用程序
>
> **Kubernetes** 的名字来源于希腊语，意思是 “舵手” 或 “飞行员”，因为它帮助我们导航和管理「**容器化**」的应用程序

想象一下，有很多个装有应用程序的小盒子「**容器**」，**Kubernetes** 就像一个聪明的管理员，帮我们安排这些盒子在哪些地方运行，确保它们正常工作，并且在需要的时候增加或减少盒子的数量

这样，我们就不需要手动去管理每一个应用程序，而是让 **Kubernetes** 来帮我们完成这些繁琐的任务

#### 1.2、Kubernetes 的主要功能

1. **自动部署和回滚**：定义应用程序的期望状态，**Kubernetes** 会自动将实际状态调整到期望状态
   - 例如：如果某个容器出现故障，**Kubernetes** 会自动重新启动或替换它
2. **服务发现和负载均衡**：**Kubernetes** 可以使用 **DNS** 名称或 **IP** 地址来暴露容器，并自动进行负载均衡，确保流量均匀分布
3. **存储编排**：**Kubernetes** 可以自动挂载用户选择的存储系统
   - 例如本地存储或云存储
4. **自我修复**：**Kubernetes** 会重新启动失败的容器、替换容器，并在准备好服务之前不将其通告给客户端
5. **水平扩缩**：根据 **CPU** 使用率或其他指标，**Kubernetes** 可以自动扩展或缩减应用程序的实例数量

#### 1.3、Kubernetes 的组件

1. **Master 节点**：**Master 节点**就像是 **Kubernetes** 集群的大脑，负责管理和控制整个系统

   > 它包含三个主要部分：
   >
   > - **API Server**： **Kubernetes** 的入口，所有的命令和请求都会先到这里，就像是一个接待员，负责接收和处理所有的指令
   > - **Scheduler**：**Scheduler** 就像是一个调度员，负责决定哪些应用程序（**Pod**）应该运行在哪些计算机（**Node**）上
   > - **Controller Manager**：这个组件负责确保系统的状态符合预期，比如确保有足够的副本在运行或者在节点故障时进行恢复

2. **Node 节点**：**Node 节点**是实际运行应用程序的地方，**Node 节点**可以是一台物理服务器，也可以是云中的一台虚拟机

   > 每个 **Node 节点**上都有两个重要的组件：
   >
   > - **Kubelet**： **Node 节点**上的一个代理，负责确保容器按照计划运行，并将状态报告给 **Master 节点**
   >
   >   <!-- Kubelet 就像是一个工头，负责确保每个容器按照计划运行。如果有问题，它会报告给 Master 节点-->
   >
   > - **Kube-proxy**： **Node 节点**上的一个网络代理，负责管理网络规则，确保网络流量能够正确地到达目标容器
   >
   >   <!-- Kube-proxy 是网络管理员，负责管理网络流量，确保请求能够正确地到达目标容器 -->

3. **Pod**：**Kubernetes** 中的==**最小部署单元**==，一个 **Pod** 可以包含一个或多个容器

4. **Service**：为一组 **Pod** 提供统一的访问入口，方便负载均衡和服务发现

<!--Master 节点直接管理 Node 节点，通过 Node 节点间接管理 Pod，Node 节点 执行 Master 节点的指令，并实际运行和管理 Pod -->

#### 1.4、Kubernetes 的优势

1. **高可用性**：通过自动化的故障恢复和负载均衡，确保应用程序的高可用性
2. **可扩展性**：可以根据需求自动扩展或缩减资源，确保资源的高效利用
3. **灵活性**：支持多种存储和网络解决方案，适用于各种应用场景
4. **跨平台**：可以在不同的云平台和操作系统上运行，具有很强的可移植性

### 二、YAML 配置文件

#### 2.1、什么是 YAML 文件？

**YAML**（**YAML Ain’t Markup Language**）是一种专门用来写配置文件的语言，它非常简洁和强大，使用起来比 **JSON** 更方便，**YAML** 文件通过缩进来表示层级关系，通常用于定义和管理 **Kubernetes** 资源

#### 2.2、YAML 文件在 Kubernetes 中的作用

在 **Kubernetes** 中，==**YAML** 文件用于定义各种资源对象的配置==，比如 **Pod**、**Service**、**Deployment** 等

通过编写 **YAML** 文件，可以描述这些资源的期望状态，然后 **Kubernetes** 会根据这些配置自动化地创建和管理资源

#### 2.3、YAML 文件的结构

一个典型的 **Kubernetes** **YAML** 文件包含以下几个部分：

1. **apiVersion**：指定 **Kubernetes API** 的版本

2. **kind**：指定资源的类型

   以下是一些常见的 **kind** 类型及其用途：

   - **Pod**：**Pod** 是 **Kubernetes** 中的最小部署单元，包含一个或多个容器
     - 它们共享相同的网络和存储资源，用于运行应用程序的实例
   - **Deployment**：**Deployment** 用于管理 **Pod** 的创建、更新和销毁
     - 它支持滚动更新和回滚，确保应用程序的高可用性和版本控制
   - **Service**：**Service** 为一组 **Pod** 提供统一的访问入口，支持负载均衡和服务发现
     - 它可以将流量分发到多个 **Pod** 上，确保应用程序的可用性
   - **ConfigMap**：**ConfigMap** 用于存储非机密的配置信息，供 **Pod** 使用
     - 它可以将配置信息注入到容器中

3. **metadata**：包含资源的元数据，比如名称、标签等

4. **spec**：定义资源的具体配置，比如容器的镜像、端口等

**示例：**以下是一个简单的 **YAML** 文件示例，用于创建一个 **Pod**

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-pod
  labels:
    app: my-app
spec:
  containers:
  - name: my-container
    image: nginx
    ports:
    - containerPort: 80
```

#### 2.4、YAML 文件与 Kubernetes 组件的关系

1. **Master 节点**：通过 **API Server** 接收和处理 **YAML** 文件中的配置，调度和管理资源
2. **Node 节点**：根据 **Master** 节点的指令，实际运行和管理 **Pod**
3. **Pod**：**YAML** 文件中定义的最小部署单元，包含一个或多个容器
4. **Service**：通过 **YAML** 文件定义，为一组 **Pod** 提供统一的访问入口

​              

​              

