## æ»‘åŠ¨çª—å£ç®—æ³•

### ä¸€ã€å‰è¨€

#### 1.1ã€æ¦‚è¿°

**ã€Œæ»‘åŠ¨çª—å£ã€**ï¼ˆ**Sliding Window**ï¼‰æ˜¯ä¸€ç§é«˜æ•ˆå¤„ç†æ•°ç»„æˆ–å­—ç¬¦ä¸²**ã€Œè¿ç»­åŒºé—´é—®é¢˜ã€**çš„ç®—æ³•æŠ€å·§ï¼Œé€šè¿‡ç»´æŠ¤ä¸€ä¸ª**ã€ŒåŠ¨æ€çª—å£ã€**æ¥å¿«é€Ÿæ±‚è§£æ»¡è¶³æ¡ä»¶çš„è¿ç»­å­æ•°ç»„æˆ–å­ä¸²

**ç‰¹æ€§ï¼š**

- **è¿ç»­æ€§**ï¼šçª—å£å†…çš„å…ƒç´ æ˜¯**ã€Œè¿ç»­çš„å­åŒºé—´ã€**
- **åŒæŒ‡é’ˆé©±åŠ¨**ï¼šé€šå¸¸ç”¨ `left` å’Œ `right` æ§åˆ¶çª—å£è¾¹ç•Œ
- **åŠ¨æ€æ›´æ–°**ï¼šæ‰©å¼ ä¸æ”¶ç¼©çª—å£æ—¶ï¼Œçª—å£çŠ¶æ€èƒ½åœ¨ **O(1)** æ—¶é—´å†…æ›´æ–°
- **å¸¸è§å¤æ‚åº¦**ï¼š**O(n)**ï¼Œé€‚åˆå¤§è§„æ¨¡æ•°æ®å¤„ç†

**é€‚ç”¨åœºæ™¯ï¼š**

- **å›ºå®šé•¿åº¦**çš„åŒºé—´ç»Ÿè®¡ï¼ˆæ±‚å’Œã€æ±‚å¹³å‡ç­‰ï¼‰
- **å¯å˜é•¿åº¦**çš„æ¡ä»¶åŒ¹é…ï¼ˆå¦‚æ— é‡å¤å­—ç¬¦ã€æœ€å°è¦†ç›–å­ä¸²ï¼‰

**æ ¸å¿ƒæ€æƒ³ï¼š**

1. **ä¸¤ä¸ªæŒ‡é’ˆ** `left`ã€`right` è¡¨ç¤ºçª—å£è¾¹ç•Œ
2. **å³æŒ‡é’ˆå³ç§»** æ‰©å±•çª—å£
3. å½“çª—å£ä¸æ»¡è¶³æ¡ä»¶æ—¶ï¼Œ**å·¦æŒ‡é’ˆå³ç§»** æ”¶ç¼©çª—å£
4. æ¯æ¬¡çª—å£è°ƒæ•´åæ›´æ–°ç»“æœ

#### 1.2ã€ç®—æ³•æ¨¡æ¿ä¸åº”ç”¨

**é€šç”¨æ¨¡æ¿ï¼š**

```js
function slidingWindow(arr, conditionCheck, updateResult) {
  let left = 0;
  let windowState = {}; // ç”¨äºç»´æŠ¤çª—å£çŠ¶æ€ï¼ˆè®¡æ•°ã€å’Œã€Setã€Mapç­‰ï¼‰

  for (let right = 0; right < arr.length; right++) {
    // 1. åŠ å…¥æ–°å…ƒç´ ï¼ˆæ‰©å±•çª—å£ï¼‰
    addElementToWindow(windowState, arr[right]);

    // 2. å½“çª—å£ä¸æ»¡ä½æ¡ä»¶æ—¶ï¼Œå·¦æŒ‡é’ˆå³ç§»ï¼Œæ”¶ç¼©çª—å£
    while (!conditionCheck(windowState)) {
      removeElementFromWindow(windowState, arr[left]);
      left++;
    }

    // 3. æ¯æ¬¡çª—å£è°ƒæ•´åï¼Œæ›´æ–°ç»“æœ
    updateResult(windowState, left, right);
  }
}
```

> æ ¸å¿ƒæ˜¯ï¼š**æ‰©å¼  + æ”¶ç¼© + æ›´æ–°çŠ¶æ€** ä¸‰æ­¥å¾ªç¯
>
> **æ”¶ç¼©** å’Œ **æ›´æ–°çŠ¶æ€** çš„é¡ºåºå–å†³äºçª—å£é•¿åº¦æ˜¯å¦å›ºå®š
>
> - å›ºå®šçª—å£é•¿åº¦
>   - å…ˆæ›´æ–°çŠ¶æ€ï¼Œå†æ”¶ç¼©çª—å£
>   - çª—å£é•¿åº¦æ»¡è¶³æ¡ä»¶æ—¶ï¼Œçª—å£å°±å·²ç»æœ‰æ•ˆäº†
> - éå›ºå®šçª—å£é•¿åº¦
>   - å…ˆæ”¶ç¼©çª—å£ï¼Œå†æ›´æ–°çŠ¶æ€
>   - éœ€è¦å…ˆä¿è¯çª—å£æœ‰æ•ˆ
>
> é€šç”¨æ¨¡æ¿ä¸­ä¸€èˆ¬æ˜¯ï¼Œå…ˆæ”¶ç¼©çª—å£ï¼Œåœ¨æ›´æ–°çŠ¶æ€ï¼Œå› ä¸ºå¤§å¤šæ•°å¤æ‚é¢˜éƒ½æ˜¯éå›ºå®šçª—å£
>
> **ä¸‰ä¸ªçµé­‚é—®é¢˜ï¼š**<!--â€¼ï¸å¾ˆé‡è¦-->
>
> 1. ä»€ä¹ˆæ—¶å€™åº”è¯¥æ‰©å¤§çª—å£ï¼Ÿ
> 2. ä»€ä¹ˆæ—¶å€™åº”è¯¥ç¼©å°çª—å£ï¼Ÿ
> 3. ä»€ä¹ˆæ—¶å€™å¾—åˆ°ä¸€ä¸ªåˆæ³•çš„ç­”æ¡ˆï¼Ÿ

**å…·ä½“ä½¿ç”¨ï¼š**

**æè¿°ï¼š**ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` å’Œæ•´æ•° `k`ï¼Œæ‰¾å‡ºé•¿åº¦æ°å¥½ä¸º `k` çš„è¿ç»­å­æ•°ç»„çš„æœ€å¤§å’Œ

**ç¤ºä¾‹ï¼š**

```markdown
è¾“å…¥ï¼š[1, 2, 3, 4, 5], 2
è¾“å‡ºï¼š9 (4+5)
```

**é¢˜è§£ï¼š**

```javascript
function maxSumSubarray(nums, k) {
  // å®šä¹‰å·¦æŒ‡é’ˆ
  let left = 0;
  // åˆ›å»ºä¸€ä¸ªçª—å£çŠ¶æ€å¯¹è±¡ï¼Œç”¨äºç»´æŠ¤çª—å£å†…çš„çŠ¶æ€ï¼Œsum ç”¨äºè®°å½•çª—å£å†…çš„å’Œï¼Œsize ç”¨äºè®°å½•çª—å£å†…çš„å…ƒç´ ä¸ªæ•°
  let windowState = { sum: 0, size: 0 };
  let maxSum = -Infinity;

  // æ·»åŠ å…ƒç´ åˆ°çª—å£
  function addElementToWindow(state, value) {
    state.sum += value;
    state.size++;
  }

  // ç§»é™¤å…ƒç´ ä»çª—å£
  function removeElementFromWindow(state, value) {
    state.sum -= value;
    state.size--;
  }

  // æ£€æŸ¥çª—å£æ˜¯å¦æ»¡è¶³æ¡ä»¶
  function conditionCheck(state) {
    // çª—å£å¤§å°ä¸èƒ½è¶…è¿‡ k
    return state.size <= k;
  }

  // æ›´æ–°ç»“æœ
  function updateResult(state) {
    // å½“çª—å£å¤§å°åˆšå¥½ä¸º k æ—¶æ›´æ–°æœ€å¤§å€¼
    if (state.size === k) {
      maxSum = Math.max(maxSum, state.sum);
    }
  }

  // éå†æ•°ç»„ï¼Œå³æŒ‡é’ˆå³ç§»
  for (let right = 0; right < nums.length; right++) {
    // 1. åŠ å…¥æ–°å…ƒç´ ï¼ˆæ‰©å±•çª—å£ï¼‰
    addElementToWindow(windowState, nums[right]);

    // 2. å½“çª—å£ä¸æ»¡è¶³æ¡ä»¶æ—¶ï¼Œå·¦æŒ‡é’ˆå³ç§»ï¼Œæ”¶ç¼©çª—å£
    while (!conditionCheck(windowState)) {
      removeElementFromWindow(windowState, nums[left]);
      left++;
    }

    // 3. æ¯æ¬¡çª—å£è°ƒæ•´åï¼Œæ›´æ–°ç»“æœ
    updateResult(windowState, left, right);
  }

  return maxSum;
}

// ç¤ºä¾‹
console.log(maxSumSubarray([1, 2, 3, 4, 5], 2)); // è¾“å‡º 9 (4+5)

```

**è§£æï¼š**

- å…ˆåˆ›å»ºä¸€ä¸ª**çª—å£çŠ¶æ€å¯¹è±¡**å’Œä¸€ä¸ª**æœ€å¤§æ•°å˜é‡**
  - **çª—å£çŠ¶æ€å¯¹è±¡**ï¼šè®°å½•çª—å£å†…æ‰€æœ‰å…ƒç´ çš„å’Œå’Œå…ƒç´ ä¸ªæ•°
  - **æœ€å¤§æ•°å˜é‡**ï¼šè®°å½•æœ€å¤§å’Œ

- **æ‰©å±•çª—å£**
  - éå†æ•°ç»„ï¼Œå³æŒ‡é’ˆå³ç§»ï¼Œå°†æ–°å…ƒç´ æ·»åŠ åˆ°çª—å£ä¸­
  - å¹¶æ›´æ–°çª—å£çŠ¶æ€ï¼Œå…ƒç´ å’Œå¢åŠ ï¼Œå…ƒç´ ä¸ªæ•°å¢åŠ  1

- **æ”¶ç¼©çª—å£**
  - å³æŒ‡é’ˆä¸€ç›´å¾€å³ç§»åŠ¨ï¼Œå½“çª—å£å†…çš„å…ƒç´ ä¸ªæ•°è¶…è¿‡ k æ—¶ï¼Œåˆ™å·¦æŒ‡é’ˆå³ç§»ï¼Œç§»é™¤æœ€å·¦å…ƒç´ ï¼Œä½¿çª—å£å†…çš„å…ƒç´ ä¸ªæ•°ç»´æŒåœ¨ k ä¸ª
  - æ›´æ–°çª—å£çŠ¶æ€ï¼Œå…ƒç´ å’Œå‡å°‘ï¼Œå…ƒç´ ä¸ªæ•°å‡å°‘ 1

- **æ›´æ–°ç»“æœ**
  - å¦‚æœçª—å£å¤§å°åˆšå¥½ä¸º kï¼Œåˆ™æ›´æ–°æœ€å¤§å’Œï¼Œå¹¶è®°å½•å½“å‰çª—å£å†…çš„å’Œ

- æœ€åè¿”å›**æœ€å¤§å’Œ**


### äºŒã€ç»å…¸é—®é¢˜

#### 2.1ã€æœ€å°è¦†ç›–å­ä¸²

**æè¿°:**

ç»™å®šå­—ç¬¦ä¸² `s` å’Œå­—ç¬¦ä¸² `t`ï¼Œè¿”å› `s` ä¸­åŒ…å« `t` æ‰€æœ‰å­—ç¬¦çš„æœ€å°å­ä¸²ã€‚å¦‚æœä¸å­˜åœ¨è¿™æ ·çš„å­ä¸²ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸² `""`

- å­ä¸²ä¸­çš„å­—ç¬¦é¡ºåºä¸è¦æ±‚ä¸ `t` ä¸­ä¸€è‡´ï¼Œä½†å¿…é¡»å…¨éƒ¨åŒ…å«
- å¦‚æœæœ‰å¤šä¸ªé•¿åº¦ç›¸åŒçš„æœ€å°å­ä¸²ï¼Œè¿”å›ä»»æ„ä¸€ä¸ªå³å¯

**ç¤ºä¾‹:**

```markdown
è¾“å…¥: s = "ADOBECODEBANC", t = "ABC"
è¾“å‡º: "BANC"
```

**é¢˜è§£:**

```js
function minWindow(s, t) {
  // åˆ›å»ºä¸€ä¸ªçª—å£å¯¹è±¡ï¼Œç”¨äºç»´æŠ¤çª—å£å†…çš„çŠ¶æ€
  const window = new Map();
  // need ç”¨äºè®°å½•çª—å£å†…æ¯ä¸ªå­—ç¬¦çš„ä¸ªæ•°
  const need = new Map();
  for (let c of t) need.set(c, (need.get(c) || 0) + 1);
  // éœ€è¦æ»¡è¶³æ¡ä»¶çš„å­—ç¬¦ç§ç±»æ•°ï¼Œå³ t ä¸­å­—ç¬¦çš„ç§ç±»æ•°ï¼Œé‡å¤çš„å­—ç¬¦åªç®—ä¸€ä¸ª
  let needCount = need.size;
  // è®°å½•æœ€å°å­ä¸²çš„é•¿åº¦
  let minLen = Infinity
  // è®°å½•æœ€å°å­ä¸²çš„èµ·å§‹ä½ç½®
  let start = 0

  // å·¦æŒ‡é’ˆ
  let left = 0

  // éå†å­—ç¬¦ä¸² sï¼Œå³æŒ‡é’ˆå³ç§»
  for (let right = 0; right < s.length; right++) {
    let c = s[right];
    if (need.has(c)) {
      // 1. æ‰©å±•çª—å£
      window.set(c, (window.get(c) || 0) + 1);
      // å¦‚æœå½“å‰çª—å£å†…æŒ‡å®šå­—ç¬¦çš„ä¸ªæ•°ä¸éœ€è¦çš„ä¸ªæ•°ç›¸åŒï¼Œåˆ™è¯´æ˜å½“å‰çª—å£å†…è¯¥å­—ç¬¦å·²ç¬¦åˆæ¡ä»¶ï¼Œåˆ™éœ€è¦åŒ¹é…çš„ç›®æ ‡å­—ç¬¦ä¸ªæ•°å‡ 1
      if (window.get(c) === need.get(c)) needCount--;
    }

    // 2. æ»¡è¶³æ¡ä»¶æ—¶ï¼Œæ›´æ–°æœ€å°å­ä¸²çš„é•¿åº¦
    while (needCount === 0) {
      if (right - left + 1 < minLen) {
        minLen = right - left + 1;
        start = left;
      }
      // 3. æ”¶ç¼©çª—å£
      let lc = s[left];
      if (need.has(lc)) {
        // è¿™é‡Œå¾ˆå…³é”®ï¼Œåªæœ‰åœ¨å½“å‰çª—å£å†…æŒ‡å®šå­—ç¬¦çš„ä¸ªæ•°ç­‰äºéœ€è¦çš„ä¸ªæ•°æ—¶ï¼Œæ”¶ç¼©çª—å£æ‰ä¼šä½¿çª—å£å†…è¯¥å­—ç¬¦ä¸ç¬¦åˆæ¡ä»¶
        // å¤§äºæ—¶ï¼Œå°±ç®—æ”¶ç¼©ï¼Œè¿˜æ˜¯ç¬¦åˆæ¡ä»¶
        // å°äºæ—¶ï¼Œä¹‹å‰å°±åº”è¯¥å·²ç»ç»™ needCount åŠ  1 äº†ï¼Œä¸èƒ½å†æ¬¡åŠ  1 ï¼Œå¦åˆ™ needCount å°±ä¼šå¤±æ•ˆ
        if (window.get(lc) === need.get(lc)) needCount++;
        window.set(lc, window.get(lc) - 1);
      }
      left++;
    }
  }
  return minLen === Infinity ? "" : s.substring(start, start + minLen);
}

// ç¤ºä¾‹
console.log(minWindow("ADOBECODEBANC", "ABC")); // è¾“å‡º "BANC"
```

#### 2.2ã€æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²

**æè¿°:**

ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² `s`ï¼Œæ‰¾å‡ºå…¶ä¸­ä¸åŒ…å«é‡å¤å­—ç¬¦çš„ **æœ€é•¿å­ä¸²** çš„é•¿åº¦

**ç¤ºä¾‹:**

```markdown
è¾“å…¥: s = "abcabcbb"
è¾“å‡º: 3
è§£é‡Š: å› ä¸ºæ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²æ˜¯ "abc"ï¼Œæ‰€ä»¥å…¶é•¿åº¦ä¸º 3ã€‚
```

**é¢˜è§£:**

å¥—ç”¨æ¨¡æ¿çš„å®ç°

```js
function lengthOfLongestSubstring(s) {
  // åˆ›å»ºä¸€ä¸ªçª—å£å¯¹è±¡ï¼Œç”¨äºç»´æŠ¤çª—å£å†…çš„çŠ¶æ€
  const window = new Map();
  // è®°å½•æœ€é•¿å­ä¸²çš„é•¿åº¦
  let maxLen = 0;
  // å·¦æŒ‡é’ˆ
  let left = 0;

  // éå†å­—ç¬¦ä¸² sï¼Œå³æŒ‡é’ˆå³ç§»
  for (let right = 0; right < s.length; right++) {
      // 1. æ‰©å±•çª—å£
      window.set(s[right], (window.get(s[right]) || 0) + 1);

      // 2. å½“çª—å£æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œæ”¶ç¼©çª—å£
      while (window.get(s[right]) > 1) {
        window.set(s[left], window.get(s[left]) - 1);
        left++;
      }
      // 3. æ›´æ–°ç»“æœï¼Œè®°å½•æœ€é•¿å­ä¸²çš„é•¿åº¦
      maxLen = Math.max(maxLen, right - left + 1);

  }

  return maxLen;
}

// ç¤ºä¾‹
console.log(lengthOfLongestSubstring("abcabcbb")); // è¾“å‡º 3 ("abc")
```

æ›´ç®€æ´çš„å®ç°

```js
function lengthOfLongestSubstring(s) {
  const window = new Set();
  let maxLen = 0;
  let left = 0;

  for (let right = 0; right < s.length; right++) {
    // æ”¶ç¼©çª—å£ç›´åˆ°æ²¡æœ‰é‡å¤
    while (window.has(s[right])) {
      window.delete(s[left]);
      left++;
    }
    // æ‰©å±•çª—å£
    window.add(s[right]);
    // æ›´æ–°ç»“æœ
    maxLen = Math.max(maxLen, right - left + 1);
  }

  return maxLen;
}
```

#### 2.3ã€å°† x å‡åˆ° 0 çš„æœ€å°æ“ä½œæ•°

**æè¿°:**

ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` å’Œä¸€ä¸ªæ•´æ•° `x`ã€‚æ¯ä¸€æ¬¡æ“ä½œæ—¶ï¼Œç§»é™¤æ•°ç»„ `nums` æœ€å·¦è¾¹æˆ–æœ€å³è¾¹çš„å…ƒç´ ï¼Œç„¶åä» `x` ä¸­å‡å»è¯¥å…ƒç´ çš„å€¼

å¦‚æœå¯ä»¥å°† `x` æ°å¥½å‡åˆ° `0`ï¼Œè¿”å› æœ€å°æ“ä½œæ•° ï¼›å¦åˆ™ï¼Œè¿”å› `-1` ã€‚

**ç¤ºä¾‹:**

```markdown
è¾“å…¥: nums = [1,1,4,2,3], x = 5
è¾“å‡º: 2
è§£é‡Š: æœ€ä½³è§£å†³æ–¹æ¡ˆæ˜¯ç§»é™¤åä¸¤ä¸ªå…ƒç´ ï¼Œå°† x å‡åˆ° 0ã€‚
```

**æ€è·¯ï¼š**
è¿™é“é¢˜è‹¥æ˜¯é‡‡ç”¨é€’å½’ç®—æ³•ç©·ä¸¾çš„æ€è·¯ï¼Œä¼šå¾ˆå¤æ‚ä¸”æ•ˆç‡ä½ä¸‹ï¼Œå› ä¸ºéœ€è¦è€ƒè™‘æ‰€æœ‰å¯èƒ½çš„ç»„åˆï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(2^n)

æœ‰ä¸€ä¸ªå¾ˆå·§å¦™çš„æ€è·¯æ˜¯ï¼šå°†åŸé—®é¢˜ï¼ˆ<!--ä»ä¸¤ç«¯ç§»é™¤å…ƒç´ ï¼Œä½¿å’Œä¸º x-->ï¼‰è½¬åŒ–ä¸ºä¸€ä¸ªé€†å‘çš„é—®é¢˜ï¼ˆ<!--ä¿ç•™ä¸­é—´å…ƒç´ ï¼Œä½¿å’Œä¸º total - x-->ï¼‰ï¼Œä¹Ÿå°±æ˜¯æ‰¾åˆ°å½“å‰æ•°ç»„ä¸­å’Œä¸º total - x çš„**æœ€é•¿å­æ•°ç»„**ï¼Œæœ€åè¿”å›åŸæ•°ç»„é•¿åº¦å‡å»è¯¥å­æ•°ç»„é•¿åº¦ï¼Œå³ä¸ºæœ€å°æ“ä½œæ•°

è¿™æ ·ä¾¿å¯ä»¥é€šè¿‡æ»‘åŠ¨çª—å£çš„ç®—æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ <!--æ€ç»´è½¬æ¢å·§å¦™ï¼š åŒ–ç¹ä¸ºç®€ï¼Œå°†å¤æ‚çš„ä¸¤ç«¯æ“ä½œè½¬ä¸ºç®€å•çš„ä¸­é—´æŸ¥æ‰¾-->

**é¢˜è§£:**

```js
var minOperations = function(nums, x) {
    // æ ¸å¿ƒæ€æƒ³ï¼šé€†å‘æ€ç»´
    // ä»ä¸¤ç«¯ç§»é™¤å…ƒç´ ä½¿å’Œä¸ºxï¼Œç­‰ä»·äºåœ¨ä¸­é—´æ‰¾ä¸€ä¸ªå­æ•°ç»„ä½¿å’Œä¸º(total - x)

    const total = nums.reduce((sum, num) => sum + num, 0);
    const target = total - x;

    // å¦‚æœtarget < 0ï¼Œè¯´æ˜xæ¯”æ€»å’Œè¿˜å¤§ï¼Œæ— è§£
    if (target < 0) return -1;

    // å¦‚æœtarget = 0ï¼Œè¯´æ˜è¦ç§»é™¤æ‰€æœ‰å…ƒç´ 
    if (target === 0) return nums.length;

    // ä½¿ç”¨æ»‘åŠ¨çª—å£æ‰¾æœ€é•¿çš„å­æ•°ç»„ï¼Œä½¿å…¶å’Œç­‰äºtarget
    let left = 0;
    let currentSum = 0;
    let maxLength = -1;

    for (let right = 0; right < nums.length; right++) {
        // æ‰©å¤§çª—å£
        currentSum += nums[right];

        // æ”¶ç¼©çª—å£ï¼Œç›´åˆ°å’Œä¸è¶…è¿‡target
        while (currentSum > target && left <= right) {
            currentSum -= nums[left];
            left++;
        }

        // å¦‚æœæ‰¾åˆ°å’Œä¸ºtargetçš„å­æ•°ç»„ï¼Œæ›´æ–°æœ€å¤§é•¿åº¦
        if (currentSum === target) {
            maxLength = Math.max(maxLength, right - left + 1);
        }
    }

    // å¦‚æœæ‰¾ä¸åˆ°ç¬¦åˆæ¡ä»¶çš„å­æ•°ç»„ï¼Œè¿”å›-1
    // å¦åˆ™è¿”å›éœ€è¦ç§»é™¤çš„å…ƒç´ ä¸ªæ•°
    return maxLength === -1 ? -1 : nums.length - maxLength;
};

// ç¤ºä¾‹
console.log(minOperations([1,1,4,2,3], 5)); // è¾“å‡º 2

```

**è§£æï¼š**

```markdown
ç¤ºä¾‹ï¼š nums = [1,1,4,2,3], x = 5
```

æ‰§è¡Œè¿‡ç¨‹

```markdown
æ­¥éª¤1: total = 11, target = 11 - 5 = 6
æ­¥éª¤2: ç”¨æ»‘åŠ¨çª—å£æ‰¾å’Œä¸º6çš„æœ€é•¿å­æ•°ç»„

çª—å£ç§»åŠ¨è¿‡ç¨‹ï¼š
right=0: [1] sum=1 < 6
right=1: [1,1] sum=2 < 6
right=2: [1,1,4] sum=6 = 6 âœ“ maxLength=3
right=3: [1,1,4,2] sum=8 > 6, æ”¶ç¼©å·¦è¾¹ç•Œ
        [1,4,2] sum=7 > 6, ç»§ç»­æ”¶ç¼©
        [4,2] sum=6 = 6 âœ“ maxLength=2
right=4: [4,2,3] sum=9 > 6, æ”¶ç¼©
        [2,3] sum=5 < 6

æœ€é•¿å­æ•°ç»„é•¿åº¦ = 3
æœ€å°æ“ä½œæ•° = 5 - 3 = 2 âœ“
```

#### 2.4ã€å­˜åœ¨é‡å¤å…ƒç´  III

**æè¿°:**

ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ `nums` å’Œä¸¤ä¸ªæ•´æ•° `indexDiff` å’Œ `valueDiff`ã€‚è¯·åˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸¤ä¸ªä¸åŒä¸‹æ ‡ `i` å’Œ `j`ï¼Œä½¿å¾— `abs(nums[i] - nums[j]) <= valueDiff`ï¼ŒåŒæ—¶åˆæ»¡è¶³ `abs(i - j) <= indexDiff`ã€‚

**ç¤ºä¾‹:**

```markdown
è¾“å…¥: nums = [1,2,3,1], indexDiff = 3, valueDiff = 0
è¾“å‡º: true
è§£é‡Š: å­˜åœ¨ä¸¤ä¸ªä¸åŒä¸‹æ ‡ i = 0 å’Œ j = 3ï¼Œæ»¡è¶³ nums[i] = 1 å’Œ nums[j] = 1ã€‚
åŒæ—¶æ»¡è¶³ abs(i - j) <= 3 å’Œ abs(nums[i] - nums[j]) <= 0ã€‚
```

**é¢˜è§£ 1ï¼šæ¡¶è§£æ³• + æ»‘åŠ¨çª—å£**

> **â€œæ¡¶è§£æ³•â€ï¼ˆBucket Methodï¼‰**å¹¶ä¸æ˜¯ä¸€ç§æ ‡å‡†çš„ç‹¬ç«‹ç®—æ³•ï¼Œå®ƒæ˜¯ä¸€ç§**å¸¸ç”¨çš„æŠ€å·§/æ€è·¯**
>
> **æ ¸å¿ƒæ€æƒ³**ï¼šå°†æ•°å€¼ç©ºé—´åˆ’åˆ†æˆè‹¥å¹²ä¸ªå›ºå®šå¤§å°çš„åŒºé—´ï¼ˆæ¡¶ï¼‰ï¼Œåˆ©ç”¨æ¡¶ç¼–å·å¿«é€Ÿåˆ¤æ–­æ•°å€¼å·®æ˜¯å¦åœ¨æŸä¸ªèŒƒå›´å†…
>
> **æ ¸å¿ƒæ­¥éª¤**ï¼š
>
> 1. å°†æ•°å€¼ç©ºé—´åˆ’åˆ†æˆå›ºå®šå¤§å°çš„æ¡¶ï¼ˆæ¯ä¸ªæ¡¶çš„é•¿åº¦ = `å·®å€¼ä¸Šé™ + 1`ï¼Œä¿è¯æ¡¶å†…ä»»æ„ä¸¤ä¸ªæ•°å·® â‰¤ ä¸Šé™ï¼‰
> 2. æŠŠæ¯ä¸ªæ•°æ˜ å°„åˆ°å¯¹åº”æ¡¶ç¼–å·
> 3. å¯¹æ¯ä¸ªæ–°æ•°ï¼š
>    - æ£€æŸ¥å½“å‰æ¡¶ â†’ è‹¥å·²æœ‰å…ƒç´ ï¼Œç›´æ¥æ»¡è¶³å·®å€¼è¦æ±‚
>    - æ£€æŸ¥ç›¸é‚»æ¡¶ â†’ å¯èƒ½æ»¡è¶³å·®å€¼è¦æ±‚
> 4. å¦‚æœæœ‰é¢å¤–çš„çº¦æŸï¼ˆå¦‚ä¸‹æ ‡å·® â‰¤ kï¼‰ï¼Œå¯ä»¥ç”¨æ»‘åŠ¨çª—å£é…åˆåˆ é™¤è¶…å‡ºèŒƒå›´çš„æ¡¶
>
> **å…³é”®ç‚¹**ï¼š
>
> - æ¡¶ç¼–å·é€šå¸¸ç”¨ `Math.floor(num / size)`
> - æ¡¶å¤§å° = `å·®å€¼ä¸Šé™ + 1`
> - ç¡®ä¿çª—å£å†…çš„æ¡¶ä¸ªæ•° â‰¤ æ»‘åŠ¨çª—å£é•¿åº¦çº¦æŸ
>
> **ç¤ºä¾‹ï¼š**
>
> - é—®é¢˜æè¿°ï¼šç»™å®šæ•°ç»„ `nums` å’Œå·®å€¼ä¸Šé™ `t`ï¼Œåˆ¤æ–­æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨ä¸¤ä¸ªæ•° `nums[i]` å’Œ `nums[j]`ï¼Œä½¿å¾—
>
>   ```markdown
>   |nums[i] - nums[j]| â‰¤ t
>   ```
>
> - é¢˜è§£ï¼š
>
>   ```javascript
>   function containsNearbyValue(nums, t) {
>     if (t < 0) return false;
>  
>     const buckets = new Map();
>     const size = t + 1; // æ¡¶å¤§å°
>  
>     const getBucketId = (num) => Math.floor(num / size);
>  
>     for (const x of nums) {
>       const id = getBucketId(x);
>  
>       // åŒæ¡¶ï¼šå¿…å®šå·®å€¼ â‰¤ t
>       if (buckets.has(id)) return true;
>  
>       // ç›¸é‚»æ¡¶ï¼šå·®å€¼å¯èƒ½ â‰¤ t
>       if (buckets.has(id - 1) && Math.abs(x - buckets.get(id - 1)) <= t) return true;
>       if (buckets.has(id + 1) && Math.abs(x - buckets.get(id + 1)) <= t) return true;
>  
>       // æ”¾å…¥æ¡¶
>       buckets.set(id, x);
>     }
>  
>     return false;
>   }
>  
>   // ç»“æœæ‰“å°
>   const nums = [1, 5, 9, 1];
>   const t = 3;
>   console.log(containsNearbyValue(nums, t)); // è¾“å‡º true
>   ```

æ¡¶è§£æ³•æœ¬è´¨æ˜¯ç»´æŠ¤ä¸€ç³»åˆ—çš„å·®å€¼å€æ•°çš„åŒºé—´ï¼ŒåŒæ¡¶ï¼šå¿…å®šå·®å€¼ â‰¤ tï¼Œç›¸é‚»æ¡¶ï¼šå·®å€¼å¯èƒ½ â‰¤ tï¼Œç»“åˆæ»‘åŠ¨çª—å£ç®—æ³•ï¼Œä¾¿å¯ä»¥è§£å†³æ­¤é¢˜ğŸ‘‡

```javascript
/**
 * @param {number[]} nums
 * @param {number} indexDiff
 * @param {number} valueDiff
 * @return {boolean}
 */
var containsNearbyAlmostDuplicate = function(nums, indexDiff, valueDiff) {
  // è¾¹ç•Œæ¡ä»¶ï¼Œè‹¥æ˜¯ç´¢å¼•å·®å’Œå€¼å·®å°äº0ï¼Œåˆ™è¿”å› false
  if(indexDiff < 0 || valueDiff < 0) return false

  // ç»´æŠ¤ä¸€ä¸ªçª—å£å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ˜¯ä¸€ä¸ªâ€œæ¡¶â€å¯¹è±¡ï¼Œç´¢å¼•æ˜¯æ¡¶çš„idï¼Œå€¼æ˜¯æ¡¶å†…çš„å…ƒç´ 
  const buckets = new Map()
  // æ¡¶çš„å¤§å°ï¼Œå› ä¸ºæ¡¶å†…å…ƒç´ çš„å·®å€¼ä¸èƒ½è¶…è¿‡ valueDiffï¼Œæ‰€ä»¥æ¡¶çš„å¤§å°ä¸º valueDiff + 1
  const size = valueDiff + 1

  // è·å–æ¡¶çš„idï¼Œå› ä¸ºæ¡¶å†…å…ƒç´ çš„å·®å€¼ä¸èƒ½è¶…è¿‡ valueDiffï¼Œæ‰€ä»¥æ¡¶çš„idä¸º num / size çš„å‘ä¸‹å–æ•´
  const getBucketId = (num) => Math.floor(num/size)

  // éå† nums
  for(let right = 0; right < nums.length; right++) {
    // å½“å‰å…ƒç´ 
    const x = nums[right]
    // è·å–æ¡¶çš„id
    const id = getBucketId(x)

    // æ¯ä¸€ä¸ªæ¡¶é‡Œçš„å…ƒç´ å·®å€¼å¿…ç„¶å°äºç­‰äº valueDiffï¼Œç›¸é‚»æ¡¶é‡Œçš„å…ƒç´ å·®å€¼å¯èƒ½å°äºç­‰äº valueDiff

    // è‹¥çª—å£å¯¹è±¡ä¸­å­˜åœ¨å½“å‰å…ƒç´ å¯¹åº”çš„æ¡¶ï¼Œåˆ™è¯´æ˜ä¹‹å‰æœ‰ä¸€ä¸ªå…ƒç´ å’Œå½“å‰å…ƒç´ çš„å·®å€¼å°äºç­‰äº valueDiffï¼Œ
    // å¹¶ä¸”å¾€çª—å£å¯¹è±¡ä¸­æ–°å¢äº†å®ƒçš„æ¡¶ï¼Œå› æ­¤è¯æ˜äº†å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„å…ƒç´ 
    if(buckets.has(id)) return true

    // å’Œç›¸é‚»çš„æ¡¶è¿›è¡Œæ¯”è¾ƒï¼Œè‹¥æ»¡è¶³æ¡ä»¶ï¼Œåˆ™è¿”å› true
    // ä¸ºä½•ç›¸é‚»æ¡¶çš„å…ƒç´ åªæœ‰ä¸€ä¸ªï¼Œå› ä¸ºè‹¥æ˜¯æœ‰ä¸¤ä¸ªå…ƒç´ å±äºåŒä¸€ä¸ªæ¡¶ï¼Œä¸Šä¸€æ­¥å°±å·²ç»è¿”å› true äº†
    if(buckets.has(id - 1) && Math.abs(buckets.get(id - 1) - x) <= valueDiff) return true
    if(buckets.has(id + 1) && Math.abs(buckets.get(id + 1) - x) <= valueDiff) return true

    // 1.æ‹“å±•çª—å£ï¼Œå°†å½“å‰å…ƒç´ æ’å…¥åˆ°çª—å£å¯¹è±¡ä¸­ï¼Œä¹Ÿå°±æ˜¯å°†å½“å‰å…ƒç´ æ‰€å±äºçš„æ¡¶æ’å…¥åˆ°çª—å£å¯¹è±¡ä¸­
    buckets.set(id, x)

    // 2.æ”¶ç¼©çª—å£ï¼Œè‹¥çª—å£å¤§å°è¶…è¿‡ indexDiff + 1ï¼Œåˆ™éœ€è¦ç§»é™¤çª—å£æœ€å·¦è¾¹çš„å…ƒç´ 
    while(buckets.size > indexDiff) {
      // è·å–çª—å£æœ€å·¦è¾¹çš„å…ƒç´ çš„æ¡¶çš„id
      const leftId = getBucketId(nums[right - indexDiff])
      buckets.delete(leftId)
    }
  }
  return false
}
```

**è§£æï¼š**

- é¦–å…ˆç»´æŠ¤ä¸€ä¸ªçª—å£å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ˜¯ä¸€ä¸ªâ€œæ¡¶â€å¯¹è±¡ï¼Œç´¢å¼•æ˜¯æ¡¶çš„idï¼Œå€¼æ˜¯æ¡¶å†…çš„å…ƒç´ 
- æ¡¶çš„å¤§å°ä¸º `valueDiff + 1`ï¼Œå› ä¸ºæ¡¶å†…å…ƒç´ çš„å·®å€¼ä¸èƒ½è¶…è¿‡ `valueDiff`ï¼Œæ‰€ä»¥æ¡¶çš„å¤§å°ä¸º `valueDiff + 1`
- ç›¸åŒæ¡¶ï¼šå¿…å®šå·®å€¼ `â‰¤ valueDiff`ï¼Œç›¸é‚»æ¡¶ï¼šå·®å€¼å¯èƒ½ `â‰¤ valueDiff`
- çª—å£å¯¹è±¡ä¸­åªèƒ½æœ€å¤šåªèƒ½åŒæ—¶å­˜åœ¨ `indexDiff` ä¸ªæ¡¶ï¼Œå½“è¾¾åˆ°ä¸Šé™æ—¶ï¼Œéœ€è¦å°†çª—å£æœ€å·¦è¾¹çš„å…ƒç´ å¯¹åº”çš„æ¡¶åˆ é™¤

**é¢˜è§£äºŒï¼šäºŒåˆ†æŸ¥æ‰¾æœ‰åºæ•°ç»„ + æ»‘åŠ¨çª—å£**

å’Œä¸Šé¢çš„è§£æ³•ç±»ä¼¼ï¼Œå°†çª—å£ä¸­å…ƒç´ æ·»åŠ åˆ°æœ‰åºæ•°ç»„ä¸­ï¼Œæ•°ç»„ `length` ä¸Šé™ä¸º `indexDiff` ï¼Œæ¯”è¾ƒå½“å‰å€¼å’Œå·¦å³ç›¸é‚»å€¼çš„å·®å€¼æ˜¯å¦ç¬¦åˆè¦æ±‚

å…·ä½“é¢˜è§£ğŸ‘‡

```javascript
/**
 * @param {number[]} nums
 * @param {number} indexDiff
 * @param {number} valueDiff
 * @return {boolean}
 */
var containsNearbyAlmostDuplicate = function(nums, indexDiff, valueDiff) {
  // ä¸ºä½•ä¸€ä¸ªçª—å£å¯¹è±¡ï¼Œå…¶æ˜¯ä¸€ä¸ªæœ‰åºæ•°ç»„
  const window = [];

  // éå† nums
  for(let i = 0; i < nums.length; i++) {
    const x = nums[i]

    // äºŒåˆ†æŸ¥æ‰¾è·å¾—æ’å…¥ä½ç½®, lowerBoundï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ª >= x çš„ä½
    let left = 0, right = window.length
    while(left < right) {
      const mid = left + Math.floor((right - left) / 2)

      if(window[mid] >= x) {
        right = mid
      } else {
        left = mid + 1
      }
    }

    // å› ä¸ºç»´æŠ¤äº†ä¸€ä¸ªæœ‰åºæ•°ç»„ï¼Œè‹¥æ˜¯å½“å‰å€¼å’Œå·¦å³ç›¸é‚»å€¼çš„å·®å€¼éƒ½å¤§äºvalueDiffçš„è¯ï¼Œé‚£è¯´æ˜å’Œå‰©ä½™çš„å€¼çš„å·®å€¼ä¹Ÿä¸€å®šå¤§äºvalueDiff
    // æ‰€ä»¥åªéœ€è¦æ¯”è¾ƒå½“å‰å€¼å’Œå·¦å³ç›¸é‚»å€¼å³å¯ï¼Œè‹¥æ»¡è¶³æ¡ä»¶ï¼Œåˆ™è¿”å› true

    // å’Œå³è¾¹çš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œè‹¥æ»¡è¶³æ¡ä»¶ï¼Œåˆ™è¿”å› true
    if(left < window.length && Math.abs(window[left] - x) <= valueDiff ) return true
    // å’Œå·¦è¾¹çš„å€¼è¿›è¡Œæ¯”è¾ƒï¼Œè‹¥æ»¡è¶³æ¡ä»¶ï¼Œåˆ™è¿”å› true
    if(left > 0 && Math.abs(window[left - 1] - x) <= valueDiff) return true

    // 1.æ‹“å±•çª—å£ï¼Œå°†å½“å‰å€¼æ’å…¥åˆ°æœ‰åºæ•°ç»„ä¸­
    window.splice(left, 0, x)

    // 2.æ”¶ç¼©çª—å£ï¼Œè‹¥çª—å£å¤§å°è¶…è¿‡ indexDiff + 1ï¼Œåˆ™éœ€è¦ç§»é™¤çª—å£æœ€å·¦è¾¹çš„å…ƒç´ 
    if(window.length > indexDiff) {
      const idx = window.indexOf(nums[i - indexDiff])
      window.splice(idx, 1)
    }
  }

  return false
};
```


### ä¸‰ã€æ ¸å¿ƒæ€æƒ³è§£è¯»

**æœ¬è´¨æ€»ç»“**

- **åŒæŒ‡é’ˆæ§åˆ¶çª—å£**ï¼š`left` æ”¶ç¼©ï¼Œ`right` æ‰©å±•
- **çŠ¶æ€ç»´æŠ¤**ï¼šç”¨å˜é‡/æ•°æ®ç»“æ„è®°å½•å½“å‰çª—å£ä¿¡æ¯
- **æ¡ä»¶é©±åŠ¨ç§»åŠ¨**ï¼šæ ¹æ®é¢˜ç›®æ¡ä»¶å†³å®šæ”¶ç¼©æˆ–æ‰©å±•çª—å£
- **ç»“æœå®æ—¶æ›´æ–°**ï¼šæ¯æ¬¡çª—å£å˜åŒ–æ—¶æ›´æ–°æœ€ä¼˜ç»“æœ
- **é¿å…é‡å¤è®¡ç®—**ï¼šé€šè¿‡å¢é‡æ›´æ–°ï¼Œçœå»æ¯æ¬¡å…¨é‡æ‰«æ
