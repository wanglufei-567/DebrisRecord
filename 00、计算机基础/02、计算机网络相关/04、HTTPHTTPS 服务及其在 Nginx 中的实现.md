## HTTP/HTTPS 服务及其在 Nginx 中的实现

### 一、基础知识

#### 1.1、服务与端口的基础知识

在网络世界中，「服务」与「端口」是两个不可或缺的概念，每个服务通过特定的端口与客户端通信，而这些端口是否能被公网或内网访问，决定了服务的可用性和安全性

##### 1.1.1、什么是服务？

「服务」是运行在服务器上的「软件程序」，专门为用户或其他程序提供特定的功能

例如：

- **Web 服务**：通过 **HTTP/HTTPS** 协议处理网页请求（如 **Nginx** 、**Apache**）
- **数据库服务**：提供数据存储和查询功能（如 **MySQL**、**PostgreSQL**）
- **远程管理服务**：允许管理员通过网络操作服务器（如 **SSH**）

每个服务需要通过端口来与外部进行通信

##### 1.1.2、 什么是端口？

「端口」是操作系统用来区分网络上的不同服务的「逻辑通道」

- 每个端口都有一个编号（0~65535），用来**标识**计算机上的**特定服务**

  - **端口号范围**：
    - 0-1023：**特权端口**，常用于系统服务（如 **HTTP** 的 80）
    - 1024-49151：**注册端口**，可被应用程序分配
    - 49152-65535：**动态端口**，由系统动态分配

- 服务通过绑定某个端口号来接收和发送数据

  例如：

  - **HTTP** 服务使用端口 **80**
  - **HTTPS** 服务使用端口 **443**
  - 数据库服务（如 **MySQL**）通常使用端口 **3306**

例如：在 **URL** `http://example.com:8080` 中，`:8080` 表示服务运行在 **8080** 端口上

#### 1.2、服务与端口的通信机制

##### 1.2.1、服务监听端口的原理

当服务启动时，会通过「操作系统」调用「绑定」一个或多个端口，这些「端口」成为服务的「通信入口」，用于接收和处理外部请求

例如，**Nginx** 的配置文件中可以指定监听的端口：

```nginx
server {
    listen 80;  # 监听 HTTP 请求
    listen 443 ssl;  # 监听 HTTPS 请求
}
```

##### 1.2.2、服务端口的访问类型

- **公网访问**：客户端通过服务器的「公网 IP 地址」 + 端口号访问服务
  - 例如 `http://123.45.67.89:80`
- **内网访问**：客户端通过服务器的「内网 IP 地址」 + 端口号访问服务
  - 例如 `http://192.168.1.10:80`

### 二、什么是 HTTP/HTTPS 服务？

#### 2.1、HTTP/HTTPS 服务定义

**HTTP ** 和 **HTTPS** 是最常见的通信协议，绝大多数的 **Web** 服务依赖它们来处理客户端和服务器之间的数据交互

- **HTTP**：一种无状态的协议，定义了客户端和服务器之间「交换超文本」的**规则**
- **HTTPS**：在 **HTTP** 的基础上，添加了 **SSL/TLS** 加密层，保障通信的机密性、完整性和身份验证

**HTTP/HTTPS 服务** 是实现 **HTTP** 或 **HTTPS** 协议功能的服务的统称

例如：

- **Nginx**：一个高性能的 **HTTP** 和反向代理服务器
- **Apache HTTP Serve**r：广泛使用的 **Web** 服务器
- **IIS**：微软提供的 **Web** 服务器

简而言之，**HTTP/HTTPS** 服务指的是那些能够使用 **HTTP** 或 **HTTPS** 协议与客户端通信的「软件程序」

#### 2.2、如何开启 HTTP/HTTPS 服务

新安装的服务器操作系统（如 **Ubuntu** 或 CentOS）本身并没有 **HTTP/HTTPS** 服务，仅有基础的网络功能和一些命令行工具（如 `curl` 和 `wget`）

要让服务器具备 **HTTP/HTTPS** 服务能力，需要：

1. **安装服务软件**：如 **Nginx**、**Apache**
2. **配置监听端口**：确保监听客户端请求
3. **启动服务**：运行 **HTTP/HTTPS** 服务进程

### 三、Nginx 如何成为 HTTP/HTTPS 服务？

#### 3.1、Nginx 的核心功能

**Nginx** 的主要职责是实现 **HTTP** 和 **HTTPS** 协议，它通过监听特定的网络端口（通常是 **80** 和 **443**）接收客户端的请求，根据配置文件中的规则处理这些请求，并返回相应的响应。

#### 3.2、Nginx 的默认端口

根据协议的标准定义：

- **HTTP 默认端口：80** 用于明文传输的 **HTTP** 通信
- **HTTPS 默认端口：443** 用于通过 **SSL/TLS** 加密的 **HTTPS** 通信

当客户端（如浏览器）访问一个域名或 **IP** 地址时，如果未指定端口号，浏览器会**默认使用**这两个端口

例如：

- 访问 `http://example.com` 时，默认会连接到 **80 端口**
- 访问 `https://example.com` 时，默认会连接到 **443 端口**

#### 3.3、为什么 Nginx 能监听特权端口？

在 **Linux** 系统中，**0-1023** 的端口被称为 **特权端口**，普通用户无法绑定这些端口

- **Nginx** 的权限机制：

  - 主进程以 **root 用户**运行，可以绑定特权端口
- 子进程以非特权用户运行，处理请求，从而提高安全性

**Nginx** 的配置文件中可以直接指定监听端口：

```nginx
server {
    listen 80;           # 监听 HTTP 的默认端口
    listen 443 ssl;      # 监听 HTTPS 的默认端口，启用 SSL/TLS
    server_name example.com;
    root /var/www/html;  # 设置网站的根目录
}
```

### 四、服务内网/公网访问限制

在实际使用中，可能会遇到**服务在内网可以访问，但在公网却无法访问**的情况

以下是常见原因：

1. 服务绑定的监听地址限制
   - 服务可能只监听了内网地址（如 `127.0.0.1` 或局域网 IP），而未绑定公网地址
   - **解决方法**：检查配置文件，确保监听地址为 `0.0.0.0`（全网监听）或具体的公网 IP
2. 防火墙规则限制
   - 防火墙可能阻止了公网对目标端口的访问
   - **解决方法**：允许目标端口的访问
3. 云平台的安全组规则限制
   - 在云平台（如 AWS、阿里云）中，安全组规则可能只允许内网流量或特定 IP 段访问
   -  **解决方法**：修改安全组规则，开放 80 和 443 的公网访问
4. NAT 或代理未配置
   - 如果服务器处于内网，可能需要 NAT 或反向代理来将公网请求转发到目标服务
   - **解决方法**：配置路由器或使用反向代理（如 **Nginx**）实现流量转发

#### 4.1、哪些端口是默认对外开放的？

根据服务的用途，一些端口被标准化为默认对外开放的端口，以下是常见示例：

| 协议       | 默认端口 | 说明                  |
| ---------- | -------- | --------------------- |
| HTTP       | 80       | 非加密的 Web 服务     |
| HTTPS      | 443      | 加密的 Web 服务       |
| SSH        | 22       | 远程登录管理          |
| FTP        | 21       | 文件传输协议          |
| DNS        | 53       | 域名解析服务          |
| SMTP       | 25       | 邮件发送              |
| MySQL      | 3306     | MySQL 数据库通信      |
| PostgreSQL | 5432     | PostgreSQL 数据库通信 |

### 五、总结

- **HTTP/HTTPS 服务的本质**：
   - 它们是使用 **HTTP** 和 **HTTPS** 协议进行通信的服务统称，**Nginx** 是一种典型的 **HTTP/HTTPS** 服务
   
- **Nginx 的端口监听机制**：
   - 默认监听 80（**HTTP**）和 443（**HTTPS**）利用特权权限绑定端口

- **服务器默认状态**：
   - 裸机服务器没有 **HTTP/HTTPS** 服务，需要手动安装并配置

- **公网访问的常见问题**：
   - 可能由于监听地址、防火墙规则或云平台安全组限制导致

