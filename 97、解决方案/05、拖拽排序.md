## æ‹–æ‹½æ’åº

### ä¸€ã€**Web** æ‹–æ‹½äº¤äº’æ¦‚è¿°

æ‹–æ‹½ï¼ˆ**Drag and Drop**ï¼‰äº¤äº’æ˜¯ç°ä»£ **Web** åº”ç”¨ä¸­éå¸¸é‡è¦çš„ç”¨æˆ·äº¤äº’æ–¹å¼ï¼›å®ƒå…è®¸ç”¨æˆ·é€šè¿‡é¼ æ ‡æˆ–è§¦æ‘¸æ‰‹åŠ¿æ¥ç§»åŠ¨ã€é‡æ–°æ’åˆ—æˆ–ä¼ è¾“ç•Œé¢å…ƒç´ ï¼Œæä¾›äº†ç›´è§‚ã€è‡ªç„¶çš„æ“ä½œä½“éªŒ

**å¸¸è§çš„æ‹–æ‹½äº¤äº’åœºæ™¯**

- **æ–‡ä»¶ä¸Šä¼ **ï¼šå°†æ–‡ä»¶ä»æœ¬åœ°æ‹–æ‹½åˆ°æµè§ˆå™¨ä¸Šä¼ åŒºåŸŸ
- **ä»»åŠ¡ç®¡ç†**ï¼šåœ¨çœ‹æ¿åº”ç”¨ä¸­æ‹–æ‹½ä»»åŠ¡å¡ç‰‡åœ¨ä¸åŒåˆ—ä¹‹é—´ç§»åŠ¨
- **åˆ—è¡¨æ’åº**ï¼šé€šè¿‡æ‹–æ‹½é‡æ–°æ’åˆ—åˆ—è¡¨é¡¹ç›®çš„é¡ºåº
- **ç•Œé¢å¸ƒå±€**ï¼šæ‹–æ‹½ç»„ä»¶æ¥è‡ªå®šä¹‰é¡µé¢å¸ƒå±€
- **æ•°æ®ä¼ è¾“**ï¼šåœ¨ä¸åŒå®¹å™¨ä¹‹é—´ç§»åŠ¨æ•°æ®é¡¹

### äºŒã€ä¸»æµæ‹–æ‹½äº¤äº’å·¥å…·åº“

- **React DnD**

  - **ç‰¹ç‚¹**ï¼šåŸºäº **HTML5** æ‹–æ‹½ **API**ï¼Œä½¿ç”¨ **Redux** æ¶æ„

  - **ä¼˜åŠ¿**ï¼šæˆç†Ÿç¨³å®šï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œç¤¾åŒºæ´»è·ƒ

  - **åŠ£åŠ¿**ï¼šå­¦ä¹ æ›²çº¿é™¡å³­ï¼Œé…ç½®å¤æ‚ï¼Œä½“ç§¯è¾ƒå¤§


- **React Beautiful DnD**

  - **ç‰¹ç‚¹**ï¼šä¸“æ³¨äºåˆ—è¡¨æ’åºï¼Œè§†è§‰æ•ˆæœä¼˜ç¾

  - **ä¼˜åŠ¿**ï¼šæ˜“äºä½¿ç”¨ï¼ŒåŠ¨ç”»æµç•…ï¼Œæ€§èƒ½ä¼˜ç§€

  - **åŠ£åŠ¿**ï¼šåŠŸèƒ½ç›¸å¯¹å•ä¸€ï¼Œä¸»è¦é€‚ç”¨äºå‚ç›´åˆ—è¡¨


- **SortableJS**

  - **ç‰¹ç‚¹**ï¼šåŸç”Ÿ **JavaScript** å®ç°ï¼Œæ¡†æ¶æ— å…³

  - **ä¼˜åŠ¿**ï¼šè½»é‡çº§ï¼Œå…¼å®¹æ€§å¥½ï¼Œæ”¯æŒå¤šç§æ’åºæ¨¡å¼

  - **åŠ£åŠ¿**ï¼š**React** é›†æˆéœ€è¦é¢å¤–å°è£…


- **dnd-kit**

  - **ç‰¹ç‚¹**ï¼šç°ä»£åŒ–çš„æ‹–æ‹½å·¥å…·åº“ï¼Œä¸“ä¸º **React** è®¾è®¡

  - **ä¼˜åŠ¿**ï¼šé«˜æ€§èƒ½ã€æ¨¡å—åŒ–ã€å¯è®¿é—®æ€§å‹å¥½ã€**TypeScript** æ”¯æŒ

  - **åŠ£åŠ¿**ï¼šç›¸å¯¹è¾ƒæ–°ï¼Œç¤¾åŒºç”Ÿæ€è¿˜åœ¨å‘å±•ä¸­


### ä¸‰ã€**dnd-kit** åŸºç¡€ä½¿ç”¨

**dnd-kit** æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ **React** æ‹–æ‹½å·¥å…·åº“ï¼Œé‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæä¾›äº†é«˜æ€§èƒ½å’Œå‡ºè‰²çš„å¯è®¿é—®æ€§æ”¯æŒ

**dnd-kit** é‡‡ç”¨äº†åˆ†å±‚æ¶æ„è®¾è®¡ï¼š

- **@dnd-kit/core**ï¼šæ ¸å¿ƒæ‹–æ‹½åŠŸèƒ½
- **@dnd-kit/sortable**ï¼šæ’åºåŠŸèƒ½æ‰©å±•
- **@dnd-kit/utilities**ï¼šå·¥å…·å‡½æ•°é›†åˆ

#### 3.1ã€åŸºç¡€æ¦‚å¿µ

- **DndContext** - æ‹–æ‹½ä¸Šä¸‹æ–‡
  - æ‹–æ‹½åŠŸèƒ½çš„æ ¹å®¹å™¨ï¼Œæä¾›æ‹–æ‹½ç¯å¢ƒå’Œå…¨å±€é…ç½®ã€‚å®ƒç®¡ç†ç€æ•´ä¸ªæ‹–æ‹½è¿‡ç¨‹çš„çŠ¶æ€å’Œäº‹ä»¶

- **ä¼ æ„Ÿå™¨ï¼ˆSensorsï¼‰** - è¾“å…¥æ£€æµ‹
  - ä¼ æ„Ÿå™¨è´Ÿè´£æ£€æµ‹ç”¨æˆ·çš„è¾“å…¥è¡Œä¸ºï¼Œæ”¯æŒé¼ æ ‡ã€è§¦æ‘¸ç­‰ä¸åŒè®¾å¤‡ã€‚æ¿€æ´»çº¦æŸå¯ä»¥é˜²æ­¢è¯¯è§¦å‘æ‹–æ‹½æ“ä½œ

- **å¯æ‹–æ‹½å…ƒç´ ï¼ˆDraggableï¼‰**
  - **useDraggable** **Hook** å°†æ™®é€šå…ƒç´ è½¬æ¢ä¸ºå¯æ‹–æ‹½å…ƒç´ ï¼Œè¿”å›å¿…è¦çš„å±æ€§å’Œæ–¹æ³•

- **æ¥æ”¶åŒºåŸŸï¼ˆDroppableï¼‰**
  - **useDroppable** **Hook** åˆ›å»ºå¯æ¥æ”¶æ‹–æ‹½çš„åŒºåŸŸï¼Œæä¾›æ‚¬åœçŠ¶æ€åé¦ˆ

-  **äº‹ä»¶å¤„ç†**
  - æ‹–æ‹½äº‹ä»¶åŒ…å«å®Œæ•´çš„æ‹–æ‹½ä¿¡æ¯ï¼Œå…è®¸å¼€å‘è€…æ ¹æ®æ‹–æ‹½ç»“æœæ›´æ–°åº”ç”¨çŠ¶æ€

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„åŸºç¡€æ‹–æ‹½ç¤ºä¾‹ `BasicDragDrop.tsx`ï¼š

```tsx
import React, { useState } from 'react'
import {
  DndContext,           // æ‹–æ‹½ä¸Šä¸‹æ–‡å®¹å™¨ï¼Œæä¾›æ‹–æ‹½åŠŸèƒ½çš„æ ¹ç»„ä»¶
  DragEndEvent,         // æ‹–æ‹½ç»“æŸäº‹ä»¶ç±»å‹ï¼ŒåŒ…å«æ‹–æ‹½ç»“æœä¿¡æ¯
  PointerSensor,        // æŒ‡é’ˆä¼ æ„Ÿå™¨ï¼Œç”¨äºæ£€æµ‹é¼ æ ‡/è§¦æ‘¸æ‹–æ‹½æ“ä½œ
  useSensor,            // åˆ›å»ºä¼ æ„Ÿå™¨çš„ Hook
  useSensors,           // ç»„åˆå¤šä¸ªä¼ æ„Ÿå™¨çš„ Hook
  closestCenter,        // ç¢°æ’æ£€æµ‹ç®—æ³•ï¼Œé€‰æ‹©è·ç¦»ä¸­å¿ƒæœ€è¿‘çš„å…ƒç´ 
  useDraggable,         // ä½¿å…ƒç´ å¯æ‹–æ‹½çš„ Hook
  useDroppable,         // ä½¿å…ƒç´ å¯æ¥æ”¶æ‹–æ‹½çš„ Hook
} from '@dnd-kit/core'
import './BasicDragDrop.css'

interface DraggableItemProps {
  id: string
  children: React.ReactNode
}
```

å¯æ‰˜æ‹½å…ƒç´ 

```javascript
/**
 * å¯æ‹–æ‹½å…ƒç´ ç»„ä»¶
 * ä½¿ç”¨ useDraggable Hook ä½¿å…ƒç´ æ”¯æŒæ‹–æ‹½åŠŸèƒ½
 */
function DraggableItem({ id, children }: DraggableItemProps) {
  // useDraggable Hookï¼šå°†å…ƒç´ æ ‡è®°ä¸ºå¯æ‹–æ‹½
  // è¿”å›æ‹–æ‹½ç›¸å…³çš„å±æ€§å’Œæ–¹æ³•
  const { attributes, listeners, setNodeRef, transform } = useDraggable({
    id: id,  // æ‹–æ‹½å…ƒç´ çš„å”¯ä¸€æ ‡è¯†ç¬¦
  })

  // æ ¹æ®æ‹–æ‹½å˜æ¢è®¡ç®—æ ·å¼
  // transform åŒ…å«æ‹–æ‹½è¿‡ç¨‹ä¸­çš„ä½ç½®åç§»é‡
  const style = transform ? {
    transform: `translate3d(${transform.x}px, ${transform.y}px, 0)`,
  } : undefined

  return (
    <div
      ref={setNodeRef}        // è®¾ç½®æ‹–æ‹½å…ƒç´ çš„ DOM å¼•ç”¨
      style={style}           // åº”ç”¨æ‹–æ‹½å˜æ¢æ ·å¼
      {...listeners}          // ç»‘å®šæ‹–æ‹½äº‹ä»¶ç›‘å¬å™¨ï¼ˆé¼ æ ‡æŒ‰ä¸‹ã€ç§»åŠ¨ç­‰ï¼‰
      {...attributes}         // ç»‘å®šæ‹–æ‹½ç›¸å…³çš„ DOM å±æ€§ï¼ˆaria å±æ€§ç­‰ï¼‰
      className="draggable-item"
    >
      {children}
    </div>
  )
}

interface DroppableZoneProps {
  id: string
  children: React.ReactNode
}
```

æ¥æ”¶æ‹–æ‹½çš„åŒºåŸŸ

```javascript
/**
 * å¯æ¥æ”¶æ‹–æ‹½çš„åŒºåŸŸç»„ä»¶
 * ä½¿ç”¨ useDroppable Hook ä½¿åŒºåŸŸèƒ½å¤Ÿæ¥æ”¶æ‹–æ‹½çš„å…ƒç´ 
 */
function DroppableZone({ id, children }: DroppableZoneProps) {
  // useDroppable Hookï¼šå°†å…ƒç´ æ ‡è®°ä¸ºå¯æ¥æ”¶æ‹–æ‹½
  // è¿”å›æ‹–æ‹½æ‚¬åœçŠ¶æ€å’Œ DOM å¼•ç”¨
  const { isOver, setNodeRef } = useDroppable({
    id: id,  // æ¥æ”¶åŒºåŸŸçš„å”¯ä¸€æ ‡è¯†ç¬¦
  })

  return (
    <div
      ref={setNodeRef}        // è®¾ç½®æ¥æ”¶åŒºåŸŸçš„ DOM å¼•ç”¨
      className={`drop-zone ${isOver ? 'over' : ''}`}  // æ ¹æ®æ‚¬åœçŠ¶æ€æ·»åŠ æ ·å¼
    >
      {children}
    </div>
  )
}
```

åŸºç¡€æ‹–æ‹½æ¼”ç¤ºç»„ä»¶

```javascript
function BasicDragDrop() {
  // ç®¡ç†æ‹–æ‹½å…ƒç´ çš„çŠ¶æ€
  // æ¯ä¸ªå…ƒç´ åŒ…å« idã€å†…å®¹å’Œæ‰€å±åŒºåŸŸä¿¡æ¯
  const [items, setItems] = useState([
    { id: '1', content: 'æ‹–æ‹½æˆ‘ 1', zone: 'source' },
    { id: '2', content: 'æ‹–æ‹½æˆ‘ 2', zone: 'source' },
    { id: '3', content: 'æ‹–æ‹½æˆ‘ 3', zone: 'source' },
  ])

  // é…ç½®æ‹–æ‹½ä¼ æ„Ÿå™¨
  // useSensorsï¼šç»„åˆå¤šä¸ªä¼ æ„Ÿå™¨
  // useSensorï¼šåˆ›å»ºå•ä¸ªä¼ æ„Ÿå™¨å®ä¾‹
  const sensors = useSensors(
    useSensor(PointerSensor, {
      activationConstraint: {
        distance: 8,  // æ¿€æ´»çº¦æŸï¼šéœ€è¦æ‹–æ‹½ 8px è·ç¦»æ‰æ¿€æ´»æ‹–æ‹½
      },
    })
  )

  /**
   * å¤„ç†æ‹–æ‹½ç»“æŸäº‹ä»¶
   * @param event æ‹–æ‹½ç»“æŸäº‹ä»¶å¯¹è±¡
   */
  function handleDragEnd(event: DragEndEvent) {
    const { active, over } = event
    // activeï¼šå½“å‰è¢«æ‹–æ‹½çš„å…ƒç´ ä¿¡æ¯
    // overï¼šæ‹–æ‹½æ‚¬åœçš„ç›®æ ‡å…ƒç´ ä¿¡æ¯

    console.log(active, over)

    if (over) {
      // å¦‚æœæ‹–æ‹½åˆ°äº†æœ‰æ•ˆçš„æ¥æ”¶åŒºåŸŸ
      setItems(items =>
        items.map(item =>
          item.id === active.id
            ? { ...item, zone: over.id as string }  // æ›´æ–°å…ƒç´ çš„æ‰€å±åŒºåŸŸ
            : item
        )
      )
    }
  }

  // æ ¹æ®åŒºåŸŸè¿‡æ»¤å…ƒç´ 
  const sourceItems = items.filter(item => item.zone === 'source')
  const targetItems = items.filter(item => item.zone === 'target')

  return (
    <div className="demo-section">
      <h2>åŸºç¡€æ‹–æ‹½æ¼”ç¤º</h2>
      <p>å°†å·¦ä¾§çš„å…ƒç´ æ‹–æ‹½åˆ°å³ä¾§åŒºåŸŸ</p>

      {/* DndContextï¼šæ‹–æ‹½åŠŸèƒ½çš„æ ¹å®¹å™¨ï¼Œæä¾›æ‹–æ‹½ä¸Šä¸‹æ–‡ */}
      <DndContext
        sensors={sensors}                    // é…ç½®æ‹–æ‹½ä¼ æ„Ÿå™¨
        collisionDetection={closestCenter}   // è®¾ç½®ç¢°æ’æ£€æµ‹ç®—æ³•
        onDragEnd={handleDragEnd}           // æ‹–æ‹½ç»“æŸæ—¶çš„å›è°ƒå‡½æ•°
      >
        <div className="basic-container">
          <div className="source-area">
            <h3>æºåŒºåŸŸ</h3>
            <DroppableZone id="source">
              {sourceItems.length === 0 ? (
                <p className="empty-message">ç©º</p>
              ) : (
                sourceItems.map(item => (
                  <DraggableItem key={item.id} id={item.id}>
                    <div className="item-content">
                      ğŸ“¦ {item.content}
                    </div>
                  </DraggableItem>
                ))
              )}
            </DroppableZone>
          </div>

          <div className="target-area">
            <h3>ç›®æ ‡åŒºåŸŸ</h3>
            <DroppableZone id="target">
              {targetItems.length === 0 ? (
                <p className="empty-message">æ‹–æ‹½åˆ°è¿™é‡Œ</p>
              ) : (
                targetItems.map(item => (
                  <DraggableItem key={item.id} id={item.id}>
                    <div className="item-content">
                      âœ… {item.content}
                    </div>
                  </DraggableItem>
                ))
              )}
            </DroppableZone>
          </div>
        </div>
      </DndContext>
    </div>
  )
}

export default BasicDragDrop
```

### å››ã€æ‹–æ‹½æ’åºå®ç°

æ‹–æ‹½æ’åºæ¯”åŸºç¡€æ‹–æ‹½æ›´å¤æ‚ï¼Œéœ€è¦å¤„ç†å…ƒç´ åœ¨åˆ—è¡¨ä¸­çš„ä½ç½®å˜åŒ–ã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„æ‹–æ‹½æ’åºç»„ä»¶å®ç°ï¼š

#### 4.1ã€é€šç”¨æ‹–æ‹½æ’åºç»„ä»¶ `DragSortable.tsx`

```tsx
import React from 'react'
import {
    DndContext,
    closestCenter,
    PointerSensor,
    useSensor,
    useSensors,
    DragEndEvent,
} from '@dnd-kit/core'
import {
    useSortable,
    SortableContext,
    verticalListSortingStrategy,
} from '@dnd-kit/sortable'
import { CSS } from '@dnd-kit/utilities'

function arrayMove<T> (array: T[], from: number, to: number): T[] {
    const result = [ ...array ]
    result.splice(to, 0, result.splice(from, 1)[0])
    return result
}

function restrictToVerticalAxis ({ transform }) {
    return {
        ...transform,
        x: 0, // å¼ºåˆ¶ x è½´åç§»ä¸º 0ï¼Œåªå…è®¸ y è½´ç§»åŠ¨
    }
}

type DragSortableItem = {
    id: string | number
    [key: string]: any
}

export interface DragSortableProps {
  items: DragSortableItem[]
  onItemsChange: (items: DragSortableItem[]) => void
  renderItem: (param: { item: DragSortableItem, index: number, dragHandleProps: any }) => React.ReactNode
}

export default function DragSortable ({
    items,
    onItemsChange,
    renderItem,
}: DragSortableProps) {
    const sensors = useSensors(
        useSensor(PointerSensor, {
            activationConstraint: { distance: 8 },
        }),
    )

    const handleDragEnd = (event: DragEndEvent) => {
        const { active, over } = event

        if (active.id !== over?.id && over?.id) {
            const oldIndex = items.findIndex(item => item.id === active.id)
            const newIndex = items.findIndex(item => item.id === over.id)

            if (oldIndex !== -1 && newIndex !== -1) {
                onItemsChange(arrayMove(items, oldIndex, newIndex))
            }
        }
    }

    function SortableItem ({ item, index }: { item: DragSortableItem; index: number }) {
        const {
            attributes,
            listeners,
            transform,
            transition,
            setNodeRef,
        } = useSortable({ id: item.id })

        const style = {
            transform: CSS.Transform.toString(transform),
            transition,
        }

        const dragHandleProps = {
            ...listeners,
            style: {
                cursor: 'grab',
            },
        }

        return (
            <div
                ref={setNodeRef}
                style={style}
                className="drag-sortable-item"
                {...attributes}
            >
                {renderItem({ item, index, dragHandleProps })}
            </div>
        )
    }

    return (
        <div className="drag-sortable-container">
            <DndContext
                sensors={sensors}
                collisionDetection={closestCenter}
                onDragEnd={handleDragEnd}
                modifiers={[ restrictToVerticalAxis ]}
            >
                <SortableContext
                    items={items.map(item => item.id)}
                    strategy={verticalListSortingStrategy}
                >
                    <div className="drag-sortable-list">
                        {items.map((item, index) => (
                            <SortableItem
                                key={item.id}
                                item={item}
                                index={index}
                            />
                        ))}
                    </div>
                </SortableContext>
            </DndContext>
        </div>
    )
}
```

#### 4.2ã€ä½¿ç”¨æ‹–æ‹½æ’åºç»„ä»¶ `SortableList.tsx`

```tsx
// React æ ¸å¿ƒåº“å¯¼å…¥
import React, { useState } from 'react'
import { DragSortable } from './DragSortable'
import './SortableList.css'
import './DragSortable.css'

function TaskCard({ item, index, dragHandleProps }: any) {
  return (
    <div className="task-card">
      <span className="task-number">#{index + 1}</span>
      <span className="task-content">{item.content}</span>

      <span
        className="drag-handle"
        {...dragHandleProps}
      >
        â‹®â‹®
      </span>
    </div>
  )
}

function SortableList() {
  const [items, setItems] = useState([
    { id: '1', content: 'ä»»åŠ¡ 1' },
    { id: '2', content: 'ä»»åŠ¡ 2' },
    { id: '3', content: 'ä»»åŠ¡ 3' },
    { id: '4', content: 'ä»»åŠ¡ 4' },
    { id: '5', content: 'ä»»åŠ¡ 5' },
  ])

  const renderTaskItem = (item: any, index: number, dragHandleProps: any) => {
    return (
      <TaskCard
        item={item}
        index={index}
        dragHandleProps={dragHandleProps}
      />
    )
  }

  return (
    <div className="demo-section">
      <h2>å¯æ’åºåˆ—è¡¨</h2>
      <p>åªèƒ½é€šè¿‡æ‹–æ‹½æ‰‹æŸ„æ¥é‡æ–°æ’åº</p>

      <div className="sortable-container">
        <DragSortable
          items={items}
          onItemsChange={setItems}
          renderItem={renderTaskItem}
        />
      </div>
    </div>
  )
}

export default SortableList
```
