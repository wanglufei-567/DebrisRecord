## 前端鉴权

### 一、概述

#### 1.1、背景

**前端鉴权**是现代 **Web** 应用中的核心组成部分，其出现源于 **HTTP 协议的无状态性**和**前端对用户身份管理的需求**：

1. **HTTP 协议是无状态的**
   - 前端请求每次都是独立的，服务器无法自动识别连续请求来自同一用户
   - 因此，必须通过额外机制维持用户会话或身份凭证
2. **前端需要识别和保存用户身份**
   - 登录后的用户信息（如用户 ID、角色、权限等）必须在前端可用，用于：
     - 渲染个性化界面
     - 控制页面功能或接口访问
     - 避免每次操作都要求重新登录
   - 前端每次请求必须携带可验证的身份凭证，确保每次请求都是合法用户发起
     - 因为每次请求都是独立的，服务器不会记住客户端的上一次状态
     - 所以前端必须在每次请求中提供身份凭证，即便用户已经登录
3. **Cookie 提供前端鉴权的基础设施**
   - Cookie 可以自动随请求发送到服务器，支持 `HttpOnly`、`Secure` 和 `SameSite` 等安全属性
   - 它为前端存储身份凭证提供便利，并降低 XSS 和 CSRF 攻击风险
   - 现代前端也可使用 `localStorage` 或 `sessionStorage` 存储 token，但 Cookie 在自动携带和安全性上仍占优势

#### 1.2、目的

**前端鉴权**的核心目标是 **保证用户身份合法、控制访问权限、保护系统安全**，具体包括：

1. **身份验证（Authentication）**
   - 确认用户身份是否真实有效，确保请求来自合法用户
2. **权限控制（Authorization）**
   - 根据用户角色或权限限制访问资源范围，防止越权操
3. **会话管理**
   - 管理用户活跃状态，实现登录、注销、过期和刷新机制，提升用户体验
4. **防护安全威胁**
   - 防止 XSS、CSRF、会话劫持等攻击，确保身份凭证安全可靠

> 简而言之，前端鉴权是 **身份验证 + 权限控制 + 会话管理 + 安全防护** 的综合体系


### 二、主流前端鉴权方案

#### 2.1、Session（会话）

**原理**：

- 用户登录后，服务器生成 **session** 对象并分配唯一 `sessionId`
- `sessionId` 通过 Cookie 返回给浏览器，浏览器自动携带
- 服务器根据 `sessionId` 验证用户身份

**特点**：

- **状态性**：服务器必须存储 **session** 信息，可结合 **Redis** 或数据库实现**分布式支持** <!--需要额外支持分布式，这个是缺点-->
- **自动过期**：可设置生命周期，提高安全性

**典型的 session 登陆/验证流程：**

<img src="https://raw.githubusercontent.com/wanglufei561/picture_repo/master/assets/202510271438368.awebp" alt="img" style="zoom:50%;" />

#### 2.2、 JWT（JSON Web Token）

**原理**：

- 登录成功后，服务器生成 **JWT**
- 前端保存 JWT（`localStorage`、`sessionStorage` 或 **Cookie**）
- 请求时通过 `Authorization` 头或 **Cookie** 携带 **JWT**，服务器解析验证身份

**特点**：

- **无状态**：服务器无需存储 **token**，易于横向扩展
  - 所有必要信息（用户身份、角色、过期时间等）都存储在 **token** 本身，服务器无需保存状态 <!--这个是优势-->
  - **Session**方案中，服务器需要存储 **session** 数据，每次请求都会多一次查询

- **自包含**：**JWT** 可携带用户信息、角色和过期时间

**典型的 JWT 登陆/验证流程**

<img src="https://raw.githubusercontent.com/wanglufei561/picture_repo/master/assets/202510271440957.awebp" alt="img" style="zoom:50%;" />

### 2.3、SSO（Single Sign-On，单点登录）

**原理**：

- 用户在认证中心登录后生成 **token** 或 session
- 访问其他系统时通过 **SSO** 验证身份，无需重复登录
- 常用协议：OAuth2、OpenID Connect、CAS

**特点**：

- **统一身份管理**：跨系统单点登录，提高用户体验
- **实现复杂**：需要认证中心和各系统协作
- **可结合 JWT 或 Session**：在各系统中验证访问权限

**适用场景**：

- 企业内部多系统统一认证
- 需要跨系统统一身份和权限管理的业务场景

### 总结

- **背景**：**HTTP 无状态** + **前端需携带身份凭证** + **Cookie** 提供基础设施
- **目的**：验证身份、控制权限、管理会话、防护安全威胁
- **主流方案**：**Session**、**JWT**、**SSO**，各有优劣，选择需根据应用架构、跨系统需求和安全要求

> 前端鉴权是身份验证、权限控制和安全管理的综合体系，而不是简单的“保存用户信息”
