## IAM（身份识别与访问管理，Identity and Access Management）

### 一、概述

**IAM（身份识别与访问管理，Identity and Access Management）** 是一种框架或系统，用于管理「数字身份」和控制对资源的「访问权限」，它通过对用户、角色、权限和策略的定义和管理，确保只有正确的人员或系统能够访问正确的资源，并执行被允许的操作

#### 1.1、IAM 的核心功能

1. **用户管理**
   - 提供对用户生命周期（创建、更新、禁用、删除）的管理
   - 支持多种身份源，如企业目录（LDAP、Active Directory）或外部身份提供商
2. **权限管理**
   - 基于最小权限原则（Least Privilege）分配访问权限
   - 支持权限委托，允许用户代表其他账户执行任务
3. **访问控制模型**
   - **基于角色的访问控制（RBAC）：** 通过为用户分配角色授予权限
   - **基于属性的访问控制（ABAC）：** 根据用户和资源的属性动态决定访问权限
   - **基于规则的访问控制（PBAC）：** 使用策略定义规则来决定权限
4. **多因子认证（MFA）**
   - 增强身份验证的安全性，通过结合多个验证因素（如密码和一次性验证码）
5. **审计与合规**
   - 提供访问日志、活动记录，支持安全事件监控
   - 帮助满足法规和合规性要求（如 GDPR、HIPAA）
6. **单点登录（SSO）**
   - 支持用户使用一个凭证访问多个应用或系统

#### 1.2、IAM 的主要组成部分

1. **身份管理（Identity Management）**
   - **用户（Users）：** 表示个人或服务账户，每个用户拥有唯一的身份
   - **组（Groups）：** 用于将用户归类，方便统一授予权限
   - **角色（Roles）：** 一种可临时分配给用户或服务的身份，通常用于跨系统或服务的访问控制
2. **访问控制（Access Control）**
   - **权限（Permissions）：** 定义用户或角色可以执行的操作（如读、写、删除）
   - **策略（Policies）：** 以规则的形式定义权限，通常是 JSON 格式，描述允许或拒绝的操作
   - **条件（Conditions）：** 细化策略的条件，例如基于时间、IP 地址、资源标识符等限制访问
3. **认证与授权（Authentication & Authorization）**
   - **认证（Authentication）：** 验证用户身份，例如通过密码、多因子认证（MFA）、访问密钥等方式
   - **授权（Authorization）：** 确保已认证的用户仅能执行被允许的操作

#### **1.3、 IAM 的典型工作流程**

1. 用户通过凭证（如用户名和密码）进行认证
2. 系统验证用户身份，并基于关联的角色或策略判断用户权限
3. 用户尝试访问资源时，IAM 检查请求是否符合权限策略
4. 若通过验证，允许用户访问资源并执行操作；否则拒绝

#### 1.4、IAM 的常见场景

1. **企业内部访问控制**
   - 为不同部门或角色分配不同的权限，例如开发团队只能访问开发环境，财务团队只能访问财务数据
2. **云服务权限管理**
   - AWS、Azure 和 Google Cloud 提供的 IAM 服务，用于管理云资源的访问权限
3. **第三方集成**
   - 通过 OAuth 授权第三方应用访问用户的部分数据
4. **临时访问**
   - 通过角色或令牌提供短时间的访问权限，降低安全风险

#### **1.5、 实施 IAM 的挑战**

1. 权限配置复杂，容易导致误配置
2. 用户身份孤岛问题，难以统一管理不同平台的身份
3. 大规模系统中的策略管理与审计难度较大

IAM 是现代 IT 安全架构的核心组件，通过集中化管理和细粒度控制，实现了身份认证与访问授权的高效、安全管理

### 二、SSO 单点登录

**单点登录（SSO，Single Sign-On）**是一种身份验证机制，允许用户通过**一次登录访问多个相关但独立的系统或应用程序**，而无需再次进行登录验证

#### 2.1、SSO 的基本原理

**SSO** 的核心在于 **集中认证** 和 **分布式授权**，用户只需一次登录，身份验证通过后，系统将生成一个可共享的认证令牌或会话凭证，用于访问其他受信任的系统或服务

1. 用户访问目标系统 A，系统 A 引导用户到认证中心（Identity Provider, IdP）进行身份验证
2. 用户通过认证后，IdP 生成一个认证凭证（如 SAML 断言、OAuth 令牌）并返回给系统 A
3. 用户携带该凭证访问系统 A
4. 当用户访问系统 B 时，系统 B 验证用户是否已登录，并使用相同的认证凭证完成授权，而无需再次登录

#### 2.2、 SSO 的主要组成部分

1. **身份提供方（IdP，Identity Provider）**
   - 中央认证机构，负责验证用户身份和生成凭证
   - 例如：Active Directory、Okta、Keycloak
2. **服务提供方（SP，Service Provider）**
   - 用户想要访问的目标系统或应用
   - 例如：Google Workspace、Salesforce
3. **认证协议**
   - 定义身份信息的传递方式及认证逻辑
   - 常用协议包括：
     - **SAML（Security Assertion Markup Language）：** XML 格式的认证协议
     - **OAuth 2.0：** 开放授权框架，常用于移动和 Web 应用
     - **OpenID Connect（OIDC）：** 基于 OAuth 2.0 的身份层协议
4. **令牌（Token）**
   - 用于在用户和服务提供方之间传递认证信息的凭证
   - 常见令牌格式：
     - **JWT（JSON Web Token）：** 轻量级、可签名的令牌
     - **SAML Token：** 包含用户身份声明的 XML 文档

#### 2.3、 SSO 的工作流程

以下是基于常见 SAML 和 OAuth 协议的 SSO 工作流程：

**基于 SAML 的 SSO 工作流程**

1. 用户尝试访问目标应用（SP）
2. SP 检测用户未登录，将用户重定向到 IdP
3. 用户在 IdP 中登录（输入用户名和密码）
4. IdP 验证身份后生成 SAML 断言，并将其发送回 SP
5. SP 验证 SAML 断言并授予用户访问权限

**基于 OAuth 2.0 的 SSO 工作流程**

1. 用户访问目标应用
2. 应用引导用户到 IdP 授权页面
3. 用户登录并授权应用
4. IdP 返回授权码给应用
5. 应用使用授权码换取访问令牌（Access Token）
6. 应用使用访问令牌验证用户身份并授予访问权限