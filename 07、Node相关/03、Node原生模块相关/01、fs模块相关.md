## NodeåŸºæœ¬ä½¿ç”¨â€”fsæ¨¡å—

### ä¸€ã€æ¦‚è¿°

**Node.js** ä¸­çš„ `fs` æ¨¡å—ï¼ˆ**File System** æ¨¡å—ï¼‰æ˜¯==ç”¨äºæ–‡ä»¶ç³»ç»Ÿæ“ä½œ==çš„æ ¸å¿ƒæ¨¡å—ä¹‹ä¸€

`fs` æ¨¡å—æä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•ï¼Œå¯ä»¥ç”¨äºæ‰§è¡Œæ–‡ä»¶çš„==è¯»å–==ã€==å†™å…¥==ã€==åˆ é™¤==ã€==ä¿®æ”¹==ã€==é‡å‘½å==ç­‰æ“ä½œ

é€šè¿‡ `fs` æ¨¡å—ï¼Œå¯ä»¥ç›´æ¥ä¸æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œè¯»å†™æ–‡ä»¶å†…å®¹ï¼Œä»¥åŠå¤„ç†æ–‡ä»¶å’Œç›®å½•

### äºŒã€åŸºç¡€ä½¿ç”¨

#### 2.1ã€æ–‡ä»¶è¯»å–å’Œå†™å…¥

- æ–‡ä»¶è¯»å–

  - **ã€Œå¼‚æ­¥è¯»å–ã€**æ–‡ä»¶çš„å†…å®¹ï¼š

    è¯­æ³•ï¼š

    ```javascript
    fs.readFile(path[, options], callback)
    ```

    ç¤ºä¾‹ï¼š

    ```javascript
    let fs = require("fs");
    // é€šè¿‡å›è°ƒå¤„ç†è¯»å–ç»“æœ
    fs.readFile("1.txt",(err,data)=>{
        if(err){
            return console.log(err);
        }
        console.log(data.toString());
    })
    ```

  - **ã€ŒåŒæ­¥è¯»å–ã€**æ–‡ä»¶çš„å†…å®¹ï¼š

    è¯­æ³•ï¼š

    ```js
    fs.readFileSync(path[, options])
    ```

    ç¤ºä¾‹ï¼š

    ```js
    let fs = require("fs");
    // 
    let res = fs.readFileSync("1.txt");
    console.log(res.toString());
    ```

- æ–‡ä»¶å†™å…¥

  - **ã€Œå¼‚æ­¥å†™å…¥ã€**æ–‡ä»¶çš„å†…å®¹ï¼š

    è¯­æ³•ï¼š

    ```javascript
    fs.writeFile(file, data[, options], callback)
    ```

    ç¤ºä¾‹ï¼š

    ```js
    let fs = require("fs");
    
    // flagé…ç½®  
    // "a":è¿½åŠ å†™å…¥
    // "w":å†™å…¥
    // "r":è¯»å–
    fs.writeFile("2.txt", "æˆ‘æ˜¯è¦å†™å…¥çš„å†…å®¹", {flag:"w"}, err=>{
        if(err){
            return console.log(err);
        }
        console.log("å†™å…¥æˆåŠŸ");   
    })
    ```

  - **ã€ŒåŒæ­¥å†™å…¥ã€**æ–‡ä»¶çš„å†…å®¹ï¼š

    è¯­æ³•ï¼š
    
    ```javascript
    fs.writeFileSync(file, data[, options])
    ```
    
    ç¤ºä¾‹ï¼š
    
    ```js
    //å¤åˆ¶æ–‡ä»¶ï¼šå…ˆè¯»å–æ–‡ä»¶å†å†™å…¥æ–‡ä»¶
    function mycopy(src, target){
       fs.writeFileSync(target, fs.readFileSync(src));
    }
    mycopy("1.txt","4.txt");
    ```

éœ€è¦æ³¨æ„ âš ï¸ çš„æ˜¯ï¼Œ`fs` æ¨¡å—ä¸­çš„==ç»å¤§å¤šæ•°æ–¹æ³•éƒ½æœ‰**ã€Œå¼‚æ­¥ã€**å’Œ**ã€ŒåŒæ­¥ã€**ä¸¤ç§ç‰ˆæœ¬==

- **å¼‚æ­¥æ–¹æ³•ä½¿ç”¨å›è°ƒå‡½æ•°æ¥å¤„ç†ç»“æœ**
- **åŒæ­¥æ–¹æ³•ç›´æ¥è¿”å›ç»“æœ**

<!--é€šå¸¸å»ºè®®ä½¿ç”¨å¼‚æ­¥æ–¹æ³•ï¼Œä»¥é¿å…é˜»å¡ä¸»çº¿ç¨‹-->

#### 2.2ã€åˆ é™¤æ–‡ä»¶å’Œç›®å½•

- **ã€Œå¼‚æ­¥åˆ é™¤ã€**æ–‡ä»¶æˆ–ç›®å½•

  è¯­æ³•ï¼š

  ```javascript
  fs.rm(path[, options], callback)
  ```

  - `path`  ï¼šè¦åˆ é™¤çš„æ–‡ä»¶æˆ–ç›®å½•è·¯å¾„

  - `options` (å¯¹è±¡ï¼Œå¯é€‰)ï¼š
    - `recursive` (å¸ƒå°”å€¼)ï¼šç”¨äºæŒ‡å®šæ˜¯å¦é€’å½’åˆ é™¤ç›®å½•åŠå…¶å†…å®¹
      - è®¾ç½®ä¸º `false` æˆ–ä¸è®¾ç½®ï¼Œå°†ä»…åˆ é™¤ç©ºç›®å½•
      - è®¾ç½®ä¸º `true` æ—¶ï¼Œé€’å½’åˆ é™¤ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•å’Œæ–‡ä»¶
    - `force` (å¸ƒå°”å€¼)ï¼šå¼ºåˆ¶åˆ é™¤ï¼Œå³ä½¿æ²¡æœ‰è¶³å¤Ÿçš„æƒé™ï¼ˆç±»ä¼¼äº `rm -f` å‘½ä»¤ï¼‰
  - `callback` (å‡½æ•°)ï¼šä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå›è°ƒæœ‰ä¸¤ä¸ªå‚æ•°ï¼š`err` å’Œ `stats`ï¼ˆåˆ é™¤æ“ä½œå®Œæˆåï¼‰

  ç¤ºä¾‹ï¼šåˆ é™¤æ–‡ä»¶

  ```javascript
  const fs = require('fs');
  
  fs.rm('/path/to/file.txt', (err) => {
    if (err) {
      console.error('åˆ é™¤æ–‡ä»¶å¤±è´¥:', err);
    } else {
      console.log('æ–‡ä»¶å·²åˆ é™¤');
    }
  });
  ```

  ç¤ºä¾‹ï¼šåˆ é™¤ç›®å½•

  ```javascript
  const fs = require('fs');
  
  // åˆ é™¤ç©ºç›®å½•
  fs.rm('/path/to/empty-directory', (err) => {
    if (err) {
      console.error('åˆ é™¤ç©ºç›®å½•å¤±è´¥:', err);
    } else {
      console.log('ç©ºç›®å½•å·²åˆ é™¤');
    }
  });
  
  // åˆ é™¤éç©ºç›®å½•ï¼ˆé€’å½’åˆ é™¤ï¼‰
  fs.rm('/path/to/non-empty-directory', { recursive: true }, (err) => {
    if (err) {
      console.error('åˆ é™¤éç©ºç›®å½•å¤±è´¥:', err);
    } else {
      console.log('éç©ºç›®å½•åŠå…¶å†…å®¹å·²åˆ é™¤');
    }
  });
  ```

- **ã€ŒåŒæ­¥åˆ é™¤ã€**æ–‡ä»¶æˆ–ç›®å½•

  è¯­æ³•ï¼š

  ```javascript
  fs.rmSync(path[, options])
  ```

  - `path`  ï¼šè¦åˆ é™¤çš„æ–‡ä»¶æˆ–ç›®å½•è·¯å¾„

  - `options` (å¯¹è±¡ï¼Œå¯é€‰)ï¼š
    - `recursive` (å¸ƒå°”å€¼)ï¼šç”¨äºæŒ‡å®šæ˜¯å¦é€’å½’åˆ é™¤ç›®å½•åŠå…¶å†…å®¹
      - è®¾ç½®ä¸º `false` æˆ–ä¸è®¾ç½®ï¼Œå°†ä»…åˆ é™¤ç©ºç›®å½•
      - è®¾ç½®ä¸º `true` æ—¶ï¼Œé€’å½’åˆ é™¤ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•å’Œæ–‡ä»¶
    - `force` (å¸ƒå°”å€¼)ï¼šå¼ºåˆ¶åˆ é™¤ï¼Œå³ä½¿æ²¡æœ‰è¶³å¤Ÿçš„æƒé™ï¼ˆç±»ä¼¼äº `rm -f` å‘½ä»¤ï¼‰

  ç¤ºä¾‹ï¼šåˆ é™¤æ–‡ä»¶

  ```javascript
  const fs = require('fs');
  
  try {
    fs.rmSync('/path/to/file.txt');
    console.log('æ–‡ä»¶å·²åˆ é™¤');
  } catch (err) {
    console.error('åˆ é™¤æ–‡ä»¶å¤±è´¥:', err);
  }
  ```

  ç¤ºä¾‹ï¼šåˆ é™¤ç›®å½•

  ```javascript
  const fs = require('fs');
  
  try {
    fs.rmSync('/path/to/directory', { recursive: true });
    console.log('ç›®å½•åŠå…¶å†…å®¹å·²åˆ é™¤');
  } catch (err) {
    console.error('åˆ é™¤ç›®å½•å¤±è´¥:', err);
  }
  ```

#### 2.3ã€é‡å‘½åæˆ–ç§»åŠ¨æ–‡ä»¶

- **ã€Œå¼‚æ­¥ã€**é‡å‘½åæˆ–ç§»åŠ¨æ–‡ä»¶

  è¯­æ³•ï¼š

  ```javascript
  fs.rename(oldPath, newPath, callback)
  ```

  ç¤ºä¾‹ï¼š

  ```js
  fs.rename("1.txt","5.txt",function (err) {
      if(err){
          console.log(err);
      }else{
          console.log("ä¿®æ”¹æˆåŠŸ");
      }
  });
  ```

- **ã€ŒåŒæ­¥ã€**é‡å‘½åæˆ–ç§»åŠ¨æ–‡ä»¶

  è¯­æ³•ï¼š

  ```
  fs.renameSync(oldPath, newPath)
  ```

#### 2.4ã€å…¶ä»–æ“ä½œ

- åˆ›å»ºç›®å½•

  - å¼‚æ­¥åˆ›å»ºç›®å½•ï¼š`fs.mkdir(path[, options], callback)`


  - åŒæ­¥åˆ›å»ºç›®å½•ï¼š`fs.mkdirSync(path[, options])`


- æ£€æŸ¥æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨
  - æ£€æŸ¥æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å¯è®¿é—®ï¼š`fs.access(path, mode, callback)`
  
  - åŒæ­¥åœ°æ£€æŸ¥æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å¯è®¿é—®ï¼š`fs.accessSync(path, mode)`
  
- `fs.watchFile(filename[, options], listener)`ï¼šç›‘è§†æ–‡ä»¶çš„å˜åŒ–
- `fs.unwatchFile(filename[, listener])`ï¼šåœæ­¢ç›‘è§†æ–‡ä»¶çš„å˜åŒ–

### ä¸‰ã€æ–‡ä»¶è¯»å–å†™å…¥ä¸å¯è¯»æµå¯å†™æµ

ã€Œè¯»å–ã€å’Œã€Œå†™å…¥ã€æ•´ä¸ªæ–‡ä»¶çš„æ–¹æ³• `fs.readFile` å’Œ `fs.writeFile` ä¸åˆ›å»ºã€Œå¯è¯»æµã€å’Œã€Œå¯å†™æµã€çš„æ–¹æ³• `fs.createReadStream` å’Œ `fs.createWriteStream `éƒ½å¯ä»¥è¿›è¡Œæ–‡ä»¶çš„**è¯»å†™æ“ä½œ**

å®ƒä»¬çš„åŒºåˆ«å¦‚ä¸‹ğŸ‘‡ï¼š

- **è¯»å–ã€å†™å…¥æ–‡ä»¶çš„æ–¹æ³• fs.readFile å’Œ fs.writeFileï¼š**
- `fs.readFile(path[, options], callback)`ï¼šç”¨äºå¼‚æ­¥è¯»å–ã€Œæ•´ä¸ªæ–‡ä»¶ã€çš„å†…å®¹å¹¶å°†å…¶è¿”å›
    - é€‚ç”¨äº**å°å‹æ–‡ä»¶**ï¼Œå› ä¸ºå®ƒå°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶åœ¨è¯»å–å®Œæˆåé€šè¿‡å›è°ƒå‡½æ•°è¿”å›æ–‡ä»¶å†…å®¹
  
  - `fs.writeFile(file, data[, options], callback)`ï¼šç”¨äºå¼‚æ­¥åœ°å°†æ•°æ®å†™å…¥æ–‡ä»¶
  - é€‚ç”¨äº**å°å‹æ–‡ä»¶**ï¼Œå› ä¸ºå®ƒå°†æ•´ä¸ªæ•°æ®å†™å…¥æ–‡ä»¶
    - å¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œä¼šè¦†ç›–æ–‡ä»¶å†…å®¹

- **åˆ›å»ºå¯è¯»æµã€å¯å†™æµçš„æ–¹æ³• fs.createReadStream å’Œ fs.createWriteStreamï¼š**
- `fs.createReadStream(path[, options])`ï¼šåˆ›å»ºä¸€ä¸ªå¯è¯»æµï¼Œç”¨äºä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®
    - é€‚ç”¨äº**å¤§å‹æ–‡ä»¶**ï¼Œ**ä»¥ã€Œå—ã€çš„å½¢å¼ã€Œè¯»å–ã€æ•°æ®**
  
  - `fs.createWriteStream(path[, options])`ï¼šåˆ›å»ºä¸€ä¸ªå¯å†™æµï¼Œç”¨äºå‘æ–‡ä»¶ä¸­å†™å…¥æ•°æ®
- é€‚ç”¨äº**å¤§å‹æ–‡ä»¶**ï¼Œ**ä»¥ã€Œå—ã€çš„å½¢å¼ã€Œå†™å…¥ã€æ•°æ®**

#### 3.1ã€å¯è¯»/å†™æµçš„ç‰¹ç‚¹

- **å¤§æ–‡ä»¶è¯»å–/å†™å…¥ï¼š** å½“éœ€è¦è¯»å–/å†™å…¥å¤§å‹æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨å¯è¯»æµ/å¯å†™æµèƒ½å¤Ÿåˆ†å—è¯»å–/å†™å…¥æ–‡ä»¶å†…å®¹ï¼Œ==é¿å…å°†æ•´ä¸ªæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œä»è€ŒèŠ‚çœå†…å­˜èµ„æº==

- **é«˜æ•ˆæ€§ï¼š** ç”±äºå¯è¯»/å¯å†™æµä»¥å—çš„å½¢å¼è¯»å–æ–‡ä»¶å†…å®¹ï¼Œèƒ½å¤Ÿæ›´åŠ é«˜æ•ˆåœ°å¤„ç†å¤§å‹æ–‡ä»¶ï¼Œå°¤å…¶åœ¨ç½‘ç»œä¼ è¾“æˆ–å¤„ç†æ—¥å¿—ç­‰åœºæ™¯ä¸‹è¡¨ç°ä¼˜ç§€

- **æµå¼å¤„ç†ï¼š** å¯è¯»/å¯å†™æµå¯ä»¥ä¸å…¶ä»–æµï¼ˆå¦‚`pipe`ï¼‰é…åˆä½¿ç”¨ï¼Œå®ç°æµå¼æ•°æ®å¤„ç†ï¼Œä½¿ä»£ç æ›´æ˜“äºç†è§£å’Œç»´æŠ¤

- **å¼‚æ­¥å¤„ç†ï¼š** å¯è¯»/å¯å†™æµæ˜¯åŸºäºäº‹ä»¶çš„å¼‚æ­¥æ¨¡å¼ï¼Œå¯ä»¥åˆ©ç”¨å›è°ƒæˆ–async/await é£æ ¼æ¥å¤„ç†è¯»å–çš„æ•°æ®

  åŸºæœ¬ç”¨æ³•å¦‚ä¸‹ğŸ‘‡ï¼š

  ```js
  const fs = require('fs');
  
  // è¾“å…¥æ–‡ä»¶è·¯å¾„
  const inputFilePath = 'input.txt';
  
  // è¾“å‡ºæ–‡ä»¶è·¯å¾„
  const outputFilePath = 'output.txt';
  
  // åˆ›å»ºå¯è¯»æµ
  const readableStream = fs.createReadStream(inputFilePath);
  
  // åˆ›å»ºå¯å†™æµ
  const writableStream = fs.createWriteStream(outputFilePath);
  
  // å°†è¯»å–åˆ°çš„æ•°æ®å—å†™å…¥åˆ°è¾“å‡ºæ–‡ä»¶
  readableStream.on('data', (chunk) => {
    writableStream.write(chunk);
  });
  
  // å½“å¯è¯»æµç»“æŸæ—¶ï¼Œå…³é—­å¯å†™æµ
  readableStream.on('end', () => {
    writableStream.end();
  });
  
  // å¤„ç†é”™è¯¯
  readableStream.on('error', (err) => {
    console.error('Error while reading file:', err);
  });
  
  writableStream.on('error', (err) => {
    console.error('Error while writing file:', err);
  });
  ```

  æˆ–è€…ğŸ‘‡

  ```js
  const fs = require('fs');
  
  // å¼‚æ­¥å‡½æ•°ï¼Œç”¨äºè¯»å–å¤§å‹æ–‡ä»¶
  async function processLargeFile(filePath) {
    const readableStream = fs.createReadStream(filePath);
  
    // ä½¿ç”¨ Buffer ä¸´æ—¶å­˜å‚¨æ•°æ®
    const chunks = [];
    let totalSize = 0;
  
    // ä½¿ç”¨ Promise æ¥ç­‰å¾…æ•°æ®è¯»å–å®Œæˆ
    await new Promise((resolve, reject) => {
      readableStream.on('data', (chunk) => {
        chunks.push(chunk);
        totalSize += chunk.length;
      });
  
      readableStream.on('end', () => {
        resolve(); // æ•°æ®è¯»å–å®Œæˆæ—¶ï¼Œè§£æ Promise
      });
  
      readableStream.on('error', (err) => {
        reject(err); // å¤„ç†é”™è¯¯æ—¶ï¼Œæ‹’ç» Promise
      });
    });
  
    // å°†æ‰€æœ‰æ•°æ®å—æ‹¼æ¥æˆä¸€ä¸ªå®Œæ•´çš„ Buffer
    const fileContentBuffer = Buffer.concat(chunks, totalSize);
  
    // åœ¨æ­¤å¤„å¯è¿›è¡Œå¯¹æ–‡ä»¶å†…å®¹çš„åç»­å¤„ç†
    console.log(fileContentBuffer.toString());
    return fileContentBuffer;
  }
  
  // ä½¿ç”¨ async/await è°ƒç”¨ processLargeFile
  (async () => {
    try {
      const filePath = 'largeFile.txt';
      const fileContentBuffer = await processLargeFile(filePath);
      // å¯ä»¥ç»§ç»­åœ¨æ­¤å¤„è¿›è¡Œå¯¹ fileContentBuffer çš„å¤„ç†
    } catch (err) {
      console.error('Error while processing large file:', err);
    }
  })();
  ```

  

