## SSH 协议

这里只是学习笔记，这篇文章写的比较详细[深入了解SSH](https://blog.haojunyu.com/post/deep_ssh)

### 一、前言

SSH(安全外壳协议)安全外壳协议,是一种**加密**的**网络传输协议**，可在不安全的网络中网络服务提供安全的传输环境。它通过在网络中创建安全隧道来实现 SSH 客户端和服务器之间的连接

**SSH** 同 **HTTPS** 一样是一种协议，整个通信过程都是加密的

### 二、原理介绍

#### 2.1、对称加密

对称加密就是加密或解密使用的是**同一个秘钥**

![](https://raw.githubusercontent.com/wanglufei561/picture_repo/master/assets/20220517084842.png)

对称加密的优缺点：

- 优点是加解密效率高，速度快

- 缺点是秘钥的管理和分发比较困难，不安全

#### 2.2、非对称加密

非对称加密需要**一对秘钥**来进行加密和解密，公开的秘钥叫公钥，私有的秘钥叫私钥

公钥加密的信息**只有**私钥才能解开（加密/解密过程），同样私钥加密的信息**只有**公钥才能解开（签名/验证过程）

![ssh_asymmetric](https://raw.githubusercontent.com/wanglufei561/picture_repo/master/assets/ssh_asymmetric.png)

非对称加密的优点是安全性更高，秘钥管理比较方便，每个服务器只要维护一对公私钥即可。缺点是加解密耗时长，速度慢

#### 2.3、加密/解密和签名/验证

非对称加密系统中的两个主要过程：

- **加密/解密**：

  - **加密**：==**发送方**使用**接收方**的**公钥加密**消息==，只有对应的私钥可以解密这个消息

  - **解密**：==**接收方**使用**自己的私钥解密**消息==

  - **举例**：
    - Alice 想发送一条机密信息给 Bob
      - Alice 使用 Bob 的公钥加密消息
      - Bob 使用自己的私钥解密消息，读取内容

- **签名/验证**：

  - **签名**：==**发送方**使用**自己的私钥**对消息进行**签名**==，这创建了一个独特的签名，证明消息确实来自发送方，并且未被篡改

  - **验证**：==**接收方**使用**发送方**的**公钥验证签名**==，确保消息的真实性和完整性

    - **示例**：

      - **Alice 生成签名**：

        - 原始消息：`"Hello, Bob"`

        - 哈希处理后得到的消息摘要（假设是）：`h1`

        - 使用 Alice 的私钥加密 `h1`，得到数字签名 `s`

        - Alice 发送的内容包括原始消息 `"Hello, Bob"` 和签名 `s`

      - **Bob 验证签名**：

        - Bob 收到消息 `"Hello, Bob"` 和签名 `s`

        - Bob 使用 Alice 的公钥解密 `s`，得到解密后的消息摘要 `h1`

        - Bob 对收到的原始消息 `"Hello, Bob"` 进行哈希处理，得到消息摘要 `h2`

        - 比较 `h1` 和 `h2`，如果相同，说明消息未被篡改，且确实来自 Alice

  - **关键点**：
    - **公钥解密签名**：这是为了确保签名确实是用对应的私钥生成的，因为只有 Alice 的私钥能生成能被 Alice 的公钥正确解密的签名
      - **消息哈希比较**：这是为了确保消息未被篡改，因为哈希函数的任何微小改变都会导致完全不同的哈希值

#### 2.4、中间人攻击

中间人攻击（**Man-in-the-Middle Attack**，**MITM**）是一种网络攻击形式，指==攻击者与通讯的两端分别创建独立的联系==，并交换其所收到的数据，使通讯的两端认为他们正在通过一个私密的连接与对方直接对话，但事实上整个会话都被攻击者完全控制

在中间人攻击中，攻击者可以拦截通讯双方的通话并插入新的内容。在许多情况下这是很简单的（例如，在一个未加密的 Wi-Fi 无线接入点的接受范围内的中间人攻击者，可以将自己作为一个中间人插入这个网络）

其具体的时序图如下：

![ssh_mitm.png](https://raw.githubusercontent.com/wanglufei561/picture_repo/master/assets/20240608084126.png)





<!--写在后面，就目前的了解，我认为SSH协议和HTTPS协议在建立网络会话这里的流程是一致的，都是先协商协议版本和加密算法的类型，之后就是非对称加密和对称加密，整个通话过程都是采用对称加密的方式进行数据交换。当然以上的认知肯定是片面的，这两种协议必然是在某一些细节处是不一样的，现在知道就有HTTPS有CA证书认证环节。网络相关的知识的深入学习任重道远，当下先囫囵吞枣的学下，后面再有针对性的系统学习下，学到什么程度呢？有个不错的标准，就是计算机考研的专业课的程度-->

