## å‡½æ•°æŸ¯é‡ŒåŒ–ä¸åæŸ¯é‡ŒåŒ–

### ä¸€ã€ä»€ä¹ˆæ˜¯æŸ¯é‡ŒåŒ–ï¼ˆcurryï¼‰

æŸ¯é‡ŒåŒ–ï¼ˆCurryingï¼‰ç»´åŸºç™¾ç§‘ä¸Šçš„è§£é‡Šæ˜¯ï¼ŒæŠŠæ¥å—**å¤šä¸ªå‚æ•°**çš„**å‡½æ•°**è½¬æ¢æˆæ¥å—ä¸€ä¸ª**å•ä¸€å‚æ•°**çš„**å‡½æ•°**

ä¸¾ä¸ªğŸŒ°ï¼š

```js
// æŸ¯é‡ŒåŒ–
var foo = function(x) {
    return function(y) {
        return x + y
    }
}

foo(3)(4)       // 7


// æ™®é€šæ–¹æ³•
var add = function(x, y) {
    return x + y;
}

add(3, 4)       //7 
```

æœ¬æ¥åº”è¯¥ä¸€æ¬¡ä¼ å…¥ä¸¤ä¸ªå‚æ•°çš„`add`å‡½æ•°ï¼ŒæŸ¯é‡ŒåŒ–ä¹‹åï¼Œå˜æˆæ¯æ¬¡è°ƒç”¨éƒ½åªç”¨ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œè°ƒç”¨ä¸¤æ¬¡åï¼Œå¾—åˆ°æœ€åçš„ç»“æœã€‚

<!--ä»…ä»ä¸Šé¢è¿™ä¸ªä¾‹å­æ¥çœ‹ï¼Œä¸å…è§‰å¾—æŸ¯é‡ŒåŒ–è¿™ä¸ªä¸œè¥¿æ²¡å•¥ç”¨ï¼Œè€Œä¸”æ”¹å˜ä¼ å‚è¿˜å¤šæ­¤ä¸€ä¸¾-->

### äºŒã€æŸ¯é‡ŒåŒ–çš„å…·ä½“å®ç°

å…¶å®ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ç†è§£**==æŸ¯é‡ŒåŒ–==**ï¼š

> æŸ¯é‡ŒåŒ–ï¼Œå¯ä»¥ç†è§£ä¸º**==æå‰æ¥æ”¶éƒ¨åˆ†å‚æ•°ï¼Œå»¶è¿Ÿæ‰§è¡Œï¼Œä¸ç«‹å³è¾“å‡ºç»“æœï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ¥å—å‰©ä½™å‚æ•°çš„å‡½æ•°==**
>
> å› ä¸ºè¿™æ ·çš„ç‰¹æ€§ï¼Œä¹Ÿè¢«ç§°ä¸º**ã€Œéƒ¨åˆ†è®¡ç®—å‡½æ•°ã€**ï¼ŒæŸ¯é‡ŒåŒ–ï¼Œæ˜¯ä¸€ä¸ªé€æ­¥æ¥æ”¶å‚æ•°çš„è¿‡ç¨‹

#### 2.1ã€åº”ç”¨ä¸¾ä¾‹

å®ç° `add(1)(2, 3)(4)() = 10` çš„æ•ˆæœ

> ä¾é¢˜æ„ï¼Œæœ‰ä¸¤ä¸ªå…³é”®ç‚¹è¦æ³¨æ„ï¼š
>
> - ä¼ å…¥å‚æ•°æ—¶ï¼Œä»£ç ä¸æ‰§è¡Œè¾“å‡ºç»“æœï¼Œè€Œæ˜¯å…ˆè®°å¿†èµ·æ¥
> - å½“ä¼ å…¥ç©ºçš„å‚æ•°æ—¶ï¼Œä»£è¡¨å¯ä»¥è¿›è¡ŒçœŸæ­£çš„è¿ç®—

å®ç°å¦‚ä¸‹ğŸ‘‡ï¼š

```js
function currying(fn){
    // ç”¨æ¥å­˜å‚¨å…¥å‚çš„æ•°ç»„
    var allArgs = [];

    // æŸ¯é‡ŒåŒ–åçš„å‡½æ•°ï¼Œè¿™é‡Œé‡‡ç”¨äº†é—­åŒ…çš„åŸç†
    return function next(){
        // å°†å‡½æ•°çš„å…¥å‚è½¬ä¸ºæ•°ç»„
        var args = Array.from(arguments);

        if(args.length > 0){
            // æœ‰å…¥å‚è¯´æ˜ä¸æ˜¯è¦çœŸæ­£æ‰§è¡Œæºå‡½æ•°ï¼Œç»§ç»­è¿”å›æŸ¯é‡ŒåŒ–åçš„å‡½æ•°
            allArgs = allArgs.concat(args);
            return next;
        }else{
            // æ— å…¥å‚ï¼Œè¯´æ˜æ˜¯è¦çœŸæ­£æ‰§è¡Œæºå‡½æ•°äº†
            return fn.apply(null, allArgs);
        }
    } 
}
var add = currying(function(){
    var sum = 0;
    for(var i = 0; i < arguments.length; i++){
        sum += arguments[i];
    }
    return sum;
});
```

æŸ¯é‡ŒåŒ–ï¼Œåœ¨ä¸Šé¢ğŸ‘†ä¾‹å­ä¸­å¯ä»¥çœ‹å‡ºå¾ˆæ˜æ˜¾çš„**è¡Œä¸ºè§„èŒƒ**ï¼š

- ==é€æ­¥æ¥æ”¶å‚æ•°==ï¼Œå¹¶**==ç¼“å­˜==**ä¾›åæœŸè®¡ç®—ä½¿ç”¨
- ==**ä¸ç«‹å³è®¡ç®—**ï¼Œ**å»¶åæ‰§è¡Œ**==
- ç¬¦åˆè®¡ç®—çš„æ¡ä»¶ï¼Œå°†ç¼“å­˜çš„å‚æ•°ï¼Œç»Ÿä¸€ä¼ é€’ç»™æ‰§è¡Œæ–¹æ³•

#### 2.2ã€è¿›é˜¶åº”ç”¨

å®ç° `add(1)(2, 3)(4)(5) = 15` çš„æ•ˆæœ

ä¸ä¸Šé¢çš„ä¾‹å­ç›¸æ¯”ï¼Œè¿™ä¸ªä¾‹å­çš„ä¸åŒåœ¨äºï¼Œä¸ç”¨æœ€åçš„ç©ºå‚æ•°ä¾¿å¯ä»¥è·å¾—è¿ç®—ç»“æœ

å…·ä½“å®ç°å¦‚ä¸‹ğŸ‘‡ï¼š

```js
function currying(fn){
  var allArgs = [];

  function next(){
    // å°†å‡½æ•°çš„å…¥å‚è½¬ä¸ºæ•°ç»„
    var args = Array.from(arguments);
    allArgs = allArgs.concat(args);
    return next;
  }
  
  // å­—ç¬¦ç±»å‹
  next.toString = function(){
      return fn.apply(null, allArgs);
  };
  
  // æ•°å€¼ç±»å‹
  next.valueOf = function(){
      return fn.apply(null, allArgs);
  }

  return next;
}

var add = currying(function(){
  var sum = 0;
  for(var i = 0; i < arguments.length; i++){
      sum += arguments[i];
  }
  return sum;
});
```

ä¸Šé¢ğŸ‘†è¿™æ®µçš„å®ç°ä¸­ï¼Œéš¾ä»¥ç†è§£çš„ç‚¹åœ¨äºè¿™æ®µğŸ‘‡JSéšå¼è½¬æ¢çš„ä½¿ç”¨â€¼ï¸

```js
  // å­—ç¬¦ç±»å‹
  next.toString = function(){
      return fn.apply(null, allArgs);
  };
  
  // æ•°å€¼ç±»å‹
  next.valueOf = function(){
      return fn.apply(null, allArgs);
  }
```

`add(1)(2, 3)(4)(5)`çš„ç»“æœå…¶å®ä»ç„¶æ˜¯ä¸ª`next`å‡½æ•°ï¼Œä½†æ­¤æ—¶çš„`allArgs`ä¸­å·²ç»ç¼“å­˜äº†æ‰€æœ‰çš„å‚æ•°`[1,2,3,4,5]`

å½“æˆ‘ä»¬å°†`add(1)(2, 3)(4)(5)`å½“ä½œæ•°å­—æˆ–è€…å­—ç¬¦ä¸²æ¥ä½¿ç”¨æ—¶ï¼Œ==JSæ‰§è¡Œå±‚ä¼šå‘ç”Ÿéšå¼ç±»å‹è½¬æ¢==ï¼Œè°ƒç”¨`toString`æˆ–`valueOf`ï¼Œä¹Ÿå°±æ˜¯è¿™æ®µä»£ç 

```js
fn.apply(null, allArgs)
```

çœ‹åˆ°è¿™é‡Œåº”è¯¥å°±æ¸…æ¥šäº†

<!--åªæƒ³è¯´ä¸€å¥ï¼Œéªšå¥—è·¯-->

### ä¸‰ã€åæŸ¯é‡ŒåŒ–çš„å…·ä½“å®ç°

ä¸æŸ¯é‡ŒåŒ–ç›¸å¯¹çš„è¿˜æœ‰ä¸€ä¸ªåæŸ¯é‡ŒåŒ–ï¼›

==æŸ¯é‡ŒåŒ–æ˜¯åˆ©ç”¨é—­åŒ…çš„åŸç†ï¼Œå°†ä¸€éƒ¨åˆ†çš„å‚æ•°**ç¼“å­˜**ä¸‹æ¥ï¼Œ**æ¥æ”¶æ›´å°‘äº›çš„å‚æ•°**ï¼Œä¸ç”¨æ¯æ¬¡éƒ½ä¼ é‡å¤çš„å‚æ•°==

==é‚£åæŸ¯é‡ŒåŒ–å°±æ˜¯è®©å‡½æ•°**æ¥æ”¶æ›´å¤šäº›å‚æ•°**==

> åæŸ¯é‡ŒåŒ–ï¼Œæ˜¯ä¸€ä¸ª**æ³›å‹åŒ–**çš„è¿‡ç¨‹ã€‚å®ƒä½¿å¾—è¢«åæŸ¯é‡ŒåŒ–çš„å‡½æ•°ï¼Œå¯ä»¥==**æ¥æ”¶æ›´å¤šå‚æ•°**==
>
> ç›®çš„æ˜¯åˆ›å»ºä¸€ä¸ªæ›´æ™®é€‚æ€§çš„å‡½æ•°ï¼Œå¯ä»¥è¢«ä¸åŒçš„å¯¹è±¡ä½¿ç”¨ï¼Œæœ‰é¸ å é¹Šå·¢çš„æ•ˆæœ

ä¸¾ä¸ªğŸŒ°ï¼š

ä½¿ç”¨`Toast`ä¸Šçš„ç§æœ‰æ–¹æ³•`show`ï¼Œå»è¾“å‡ºä¸€ä¸ªç¬¬ä¸‰æ–¹å¯¹è±¡`obj`ä¸Šçš„`prompt`

```js
function Toast(option){
  this.prompt = '';
}
Toast.prototype = {
  constructor: Toast,
  // è¾“å‡ºæç¤º
  show: function(){
    console.log(this.prompt);
  }
};

// æ–°å¯¹è±¡
var obj = {
    prompt: 'æ–°å¯¹è±¡'
};
```

å…·ä½“å®ç°ï¼š

```js
function unCurrying(fn){
    return function(){
      var args = [].slice.call(arguments);
      var that = args.shift();
      // æ”¹å˜æºå‡½æ•°çš„thisæŒ‡å‘ä¸ºå‚æ•°çš„ç¬¬ä¸€é¡¹
      return fn.apply(that, args);
    }
}

var objShow = unCurrying(Toast.prototype.show);

objShow(obj); // è¾“å‡º"æ–°å¯¹è±¡"
```

==åæŸ¯é‡ŒåŒ–çš„ç‰¹ç‚¹ï¼š==

- ==éæˆ‘ä¹‹ç‰©ï¼Œä¸ºæˆ‘æ‰€ç”¨==
- ==**å¢åŠ è¢«åæŸ¯é‡ŒåŒ–æ–¹æ³•æ¥æ”¶çš„å‚æ•°**==

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ`Toast.prototype.show`æ–¹æ³•æœ¬æ¥æ˜¯`Toast`ç±»çš„==ç§æœ‰æ–¹æ³•==ï¼Œè·Ÿæ–°å¯¹è±¡`obj`æ²¡æœ‰åŠæ¯›é’±å…³ç³»ï¼Œç»è¿‡==åæŸ¯é‡ŒåŒ–å==ï¼Œå´å¯ä»¥ä¸º`obj`å¯¹è±¡æ‰€ç”¨

 ä¸ºä»€ä¹ˆèƒ½è¢«`obj`æ‰€ç”¨ï¼Œæ˜¯å› ä¸ºå†…éƒ¨å°†`Toast.prototype.show`çš„==ä¸Šä¸‹æ–‡é‡æ–°å®šä¹‰ä¸º`obj`==ï¼Œä¹Ÿå°±æ˜¯ç”¨`apply`æ”¹å˜äº†`this`æŒ‡å‘

 è€Œå®ç°è¿™ä¸€æ­¥éª¤çš„è¿‡ç¨‹ï¼Œå°±éœ€è¦å¢åŠ åæŸ¯é‡ŒåŒ–åçš„`objShow`æ–¹æ³•å‚æ•°ã€‚

**å¦ä¸€ç§å®ç°ï¼š**

```js
Function.prototype.unCurrying = function(){
    var self = this;
    return function(){
        return Function.prototype.call.apply(self, arguments);
    }
}

// ä½¿ç”¨
var objShow = Toast.prototype.show.unCurrying();
objShow(obj);
```

ä¸Šé¢ğŸ‘†è¿™ä¸ªå®ç°ä¸­éš¾ä»¥ç†è§£çš„ç‚¹åœ¨äº`Function.prototype.call.apply`çš„ä½¿ç”¨

é¦–å…ˆæ³¨æ„`call`çš„è°ƒç”¨æ˜¯é‡‡ç”¨çš„æ˜¯`Function.prototype.call`ï¼Œç›´æ¥ç”¨çš„æ˜¯`Function`æ„é€ å‡½æ•°åŸå‹ä¸Šçš„`call`ï¼Œ`call`ä¸­çš„`this`æŒ‡å‘çš„æ˜¯`Function.prototype`;

ä½†==æˆ‘ä»¬æƒ³è¦çš„å…¶å®æ˜¯`show.call`æ‰å¯¹==ï¼Œæ‰€ä»¥éœ€è¦å°†`call`ä¸­çš„`this`æŒ‡å‘`show`ï¼Œé‚£åˆ©ç”¨`apply`å°†`this`æŒ‡å‘`self`ä¹Ÿå°±æ˜¯`show`ä¹Ÿå¯ä»¥è¾¾åˆ°æ•ˆæœ

### å››ã€å…·ä½“åº”ç”¨

#### 4.1ã€åˆ¤æ–­å˜é‡ç±»å‹ï¼ˆåæŸ¯é‡ŒåŒ–ï¼‰

```js
var fn = function(){};
var val = 1;

if(Object.prototype.toString.call(fn) == '[object Function]'){
    console.log(`${fn} is function.`);
}

if(Object.prototype.toString.call(val) == '[object Number]'){
    console.log(`${val} is number.`);
}
```

ä¸Šè¿°ä»£ç ï¼Œç”¨åæŸ¯é‡ŒåŒ–ï¼Œå¯ä»¥è¿™ä¹ˆå†™ï¼š

```javascript
var fn = function(){};
var val = 1;
var toString = Object.prototype.toString.unCurrying();

if(toString(fn) == '[object Function]'){
    console.log(`${fn} is function.`);
}

if(toString(val) == '[object Number]'){
    console.log(`${val} is number.`);
}
```

#### 4.2 ç›‘å¬äº‹ä»¶ï¼ˆæŸ¯é‡ŒåŒ–ï¼‰

```javascript
function nodeListen(node, eventName){
    return function(fn){
        node.addEventListener(eventName, function(){
            fn.apply(this, Array.prototype.slice.call(arguments));
        }, false);
    }
}

var bodyClickListen = nodeListen(document.body, 'click');
bodyClickListen(function(){
    console.log('first listen');
});

bodyClickListen(function(){
    console.log('second listen');
});
```

ä½¿ç”¨æŸ¯é‡ŒåŒ–ï¼Œä¼˜åŒ–ç›‘å¬DOMèŠ‚ç‚¹äº‹ä»¶ã€‚`addEventListener`ä¸‰ä¸ªå‚æ•°**ä¸ç”¨æ¯æ¬¡éƒ½å†™**

### äº”ã€æ€»ç»“

- æŸ¯é‡ŒåŒ–
  - é™ä½æ™®é€‚æ€§ï¼Œæé«˜é€‚ç”¨æ€§
  - ==**ç¼“å­˜éƒ¨åˆ†å‚æ•°ï¼Œä¾¿äºæ¥æ”¶æ›´å°‘çš„å‚æ•°**==
- åæŸ¯é‡ŒåŒ–
  - æé«˜æ™®é€‚æ€§
  - **==æ¥æ”¶æ›´å¤šå‚æ•°==**

### å¼•ç”¨

[æŸ¯é‡ŒåŒ–ä¸åæŸ¯é‡ŒåŒ–](https://juejin.cn/post/6844903645222273037#heading-12)

[é«˜çº§å‡½æ•°æŠ€å·§-å‡½æ•°æŸ¯é‡ŒåŒ–](https://segmentfault.com/a/1190000018265172)

